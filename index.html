<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Ragty"><meta name="copyright" content="Ragty"><title>When the world sleep, I dream. | Ragty の Blog</title><link rel="shortcut icon" href="/blog/melody-favicon.ico"><link rel="stylesheet" href="/blog/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="https://secure.gravatar.com/avatar/dcc38a5a0d37cb7348d4f72d8f6a2de0"></div><div class="author-info__name text-center">Ragty</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/huoji555" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/blog/archives"><span class="pull-left">文章</span><span class="pull-right">83</span></a><a class="author-info-articles__tags article-meta" href="/blog/tags"><span class="pull-left">标签</span><span class="pull-right">75</span></a><a class="author-info-articles__categories article-meta" href="/blog/categories"><span class="pull-left">分类</span><span class="pull-right">38</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接-Links</div><a class="author-info-links__name text-center" href="https://blog.csdn.net/huoji555" target="_blank" rel="noopener">MY-CSDN</a></div></div></div><nav id="nav" style="background-image: url(https://blog-1251750343.cos.ap-beijing.myqcloud.com/blog/blog-bg.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/blog/">Ragty の Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/blog">Home</a><a class="site-page" href="/blog/archives">Archives</a><a class="site-page" href="/blog/categories">Categories</a><a class="site-page" href="/blog/tags">Tags</a><a class="site-page" href="/blog/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="site-info"><div id="site-title">Ragty の Blog</div><div id="site-sub-title">When the world sleep, I dream.</div><div id="site-social-icons"><a class="social-icon" href="https://github.com/huoji555" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-github fab"></i></a><a class="social-icon" href="https://blog.csdn.net/huoji555" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-rss fas"></i></a></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/blog/2020/03/10/%E5%8F%8C%E6%95%B0%E7%BB%84%E5%AD%97%E5%85%B8%E6%A0%91(DATrie)%E8%AF%A6%E8%A7%A3%E5%8F%8A%E5%AE%9E%E7%8E%B0/">双数组字典树(DATrie)详解及实现</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-10</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/blog/categories/NLP/">NLP</a></span><div class="content"><a id="more"></a>

<h4 id="1-背景"><a href="#1-背景" class="headerlink" title="1.背景"></a>1.背景</h4><p><code>Trie树</code>本质是一个确定的有限状态自动机(DFA)，核心思想是空间换时间，利用字符串的公共前缀来降低查询时间的开销以达到提高效率的目的。<strong>但由于<code>Trie树</code>的稀疏现象严重，空间利用率较低</strong>为了让<code>Trie树</code>实现占用较少的空间，同时还要保证查询的效率，最后提出了用2个线性数组来进行<code>Trie树</code>的表示，即<code>双数组Trie(Double Array Trie)</code>.</p>
<br>

<h4 id="2-算法及公式解析"><a href="#2-算法及公式解析" class="headerlink" title="2.算法及公式解析"></a><strong>2.算法及公式解析</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base[s] + c = t</span><br><span class="line">check[t] =  s</span><br></pre></td></tr></table></figure>

<p>往往读到这里，大家都是一头雾水，不知所云，我们首先了解下<code>base</code>和<code>check</code>代表的意义及作用</p>
<blockquote>
<p>base数组的每个元素表示一个<code>Trie节点</code>，即一个状态(分为空闲状态和占用状态)<br>check数组的每个元素表示某个状态的前驱状态</p>
</blockquote>
<p>现在我们分析一下以上出现的公式</p>
<blockquote>
<p>base树组中的<code>s</code>代表当前状态的下标，<code>t</code>代表转移状态的下标，<code>c</code>代表输入字符的数值</p>
<p>base[s] + c =  t   //表示一次状态转移</p>
<p>由于转移后状态下标为<code>t</code>,且父子关系是唯一的，所以可通过检验当前元素的前驱状态确定转移是否成功</p>
<p>check[t] =  s    //检验状态转移是否成功</p>
</blockquote>
<p>那么这种算法相对于传统的<code>Trie树</code>的<strong>优点</strong>是，<strong>只需要一个加法一次比较即可完成一次状态转移，只花费了常数时间</strong>，下面给出了<code>双数组Trie树</code>的原理图（注意观察状态转移的过程）<br><img src="https://img-blog.csdnimg.cn/20200310233002360.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<br>

<h4 id="4-状态冲突及解决方案-划重点"><a href="#4-状态冲突及解决方案-划重点" class="headerlink" title="4.状态冲突及解决方案(划重点)"></a><strong>4.状态冲突及解决方案(划重点)</strong></h4><blockquote>
<p>说的简单一点，状态冲突的意思就是，进行状态转移时，发现转换的位置base[t]已经被人占了(<strong>状态冲突</strong>)，那你怎么办呢，重新改变c值(<strong>改变父节点的转移基数</strong>)，让它放在base数组中未被占用的位置</p>
<p>解决方案，用while函数由发生冲突的位置向前遍历，一旦发现有空位置便占用并更新转移基数(<strong>也就是c值</strong>)，可以把这个过程看作为公交车上从后往前占座的过程</p>
<p>构造字典时，如果有新词加入，若新词的首字未出现，写入时有冲突的情况下，导致根节点的转移基数改变，会导致重构整个树的情况(否则不能进行正确的状态转移)，所以<strong>构建树时建议先构建每个词的首字，再构建各个词的子节点</strong>，这样产生冲突的情况下，可以将冲突局限在单个父节点和子节点之间，不至于大范围的节点重构</p>
</blockquote>
<br>

<h4 id="5-叶子节点的构造与处理"><a href="#5-叶子节点的构造与处理" class="headerlink" title="5.叶子节点的构造与处理"></a><strong>5.叶子节点的构造与处理</strong></h4><p>下面介绍几种处理叶子节点的处理方案：</p>
<ul>
<li><strong>将每个词的词尾设置为特殊字符(/0)</strong>，因为最后一个字已经不需要状态转移，所以可以这样构造，但是增加了节点的数量，构建字典时会造成消耗</li>
<li><strong>将每个词的词尾设置为转移基数的负数(只有词尾为负值)</strong>，这样能够节省构建时间，不过进行转移时要将状态转移函数改为<code>|base[s]|+code(字符)</code></li>
</ul>
<p>我们的实现中采用后一种构建方案</p>
<br>

<h4 id="6-双字典树结构"><a href="#6-双字典树结构" class="headerlink" title="6.双字典树结构"></a><strong>6.双字典树结构</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> ARRAY_SIZE = <span class="number">655350</span>;  <span class="comment">//数组大小</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> BASE_ROOT = <span class="number">1</span>;        <span class="comment">//base根节点状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> BASE_NULL = <span class="number">0</span>;        <span class="comment">//base空闲状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> CHECK_ROOT = -<span class="number">1</span>;      <span class="comment">//check根节点状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> CHECK_NULL = -<span class="number">2</span>;      <span class="comment">//check空闲状态</span></span><br><span class="line"><span class="keyword">private</span> TrieNode base[];</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> check[];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/3/5 16:05</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: DATrie节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> transferRatio; <span class="comment">//转移基数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isLeaf = <span class="keyword">false</span>; <span class="comment">//是否为叶子节点</span></span><br><span class="line">    <span class="keyword">private</span> Character label = <span class="keyword">null</span>; <span class="comment">//节点标识即插入的字符本身</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value = -<span class="number">1</span>; <span class="comment">//当该节点为叶子节点时关联的字典表中对应词条的索引号</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTransferRatio</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> transferRatio;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransferRatio</span><span class="params">(<span class="keyword">int</span> transferRatio)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transferRatio = transferRatio;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLeaf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isLeaf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeaf</span><span class="params">(<span class="keyword">boolean</span> leaf)</span> </span>&#123;</span><br><span class="line">        isLeaf = leaf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Character <span class="title">getLabel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> label;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLabel</span><span class="params">(Character label)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.label = label;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="7-双字典树的构建"><a href="#7-双字典树的构建" class="headerlink" title="7.双字典树的构建"></a><strong>7.双字典树的构建</strong></h4><blockquote>
<p>这里说一句，构建的准则是，<strong>先构建每个词的首字，后构建每个词的剩余节点</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/3/10 19:37</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 构造DATrie</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(List&lt;String&gt; words)</span> </span>&#123;</span><br><span class="line">    init();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> shut = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> idx = <span class="number">0</span>; idx &lt; words.size(); idx++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> startState = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span> chars[] = words.get(idx).toCharArray();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (shut == <span class="keyword">false</span>) &#123;</span><br><span class="line">            TrieNode node = insert(startState, getCode(chars[<span class="number">0</span>]), (chars.length == <span class="number">1</span>), idx);</span><br><span class="line">            node.setLabel(chars[<span class="number">0</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;chars.length; j++) &#123;</span><br><span class="line">                startState = transfer(startState, getCode(chars[j-<span class="number">1</span>]));</span><br><span class="line">                TrieNode node = insert(startState, getCode(chars[j]), (chars.length == j+<span class="number">1</span>), idx);</span><br><span class="line">                node.setLabel(chars[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (idx == words.size()-<span class="number">1</span> &amp;&amp; shut == <span class="keyword">false</span>) &#123;</span><br><span class="line">            idx = -<span class="number">1</span>;   <span class="comment">//因为开始的时候还有一个加的过程</span></span><br><span class="line">            shut = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/3/5 16:06</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 初始化DATrie（base，check数组全部初始化）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    base = <span class="keyword">new</span> TrieNode[ARRAY_SIZE];</span><br><span class="line">    check = <span class="keyword">new</span> <span class="keyword">int</span>[ARRAY_SIZE];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">        TrieNode node = <span class="keyword">new</span> TrieNode();</span><br><span class="line">        node.setTransferRatio(BASE_NULL);</span><br><span class="line">        base[i] = node;</span><br><span class="line">        check[i] = CHECK_NULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TrieNode root = <span class="keyword">new</span> TrieNode();</span><br><span class="line">    root.setTransferRatio(BASE_ROOT);</span><br><span class="line">    base[<span class="number">0</span>] = root;</span><br><span class="line">    check[<span class="number">0</span>] = CHECK_ROOT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="8-双数组字典树的插入"><a href="#8-双数组字典树的插入" class="headerlink" title="8.双数组字典树的插入"></a>8.双数组字典树的插入</h4><blockquote>
<p>插入时，有冲突需要解决冲突，无冲突再检查是否为叶子节点，最后进行状态转移</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/3/5 18:49</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 根据起始状态和转移技术插入新节点并返回插入的节点</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> startState 起始状态</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> offset  状态偏移量</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> isLeaf  是否为叶子节点</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> idx 当前节点在词典中的索引号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> TrieNode <span class="title">insert</span><span class="params">(<span class="keyword">int</span> startState, <span class="keyword">int</span> offset, <span class="keyword">boolean</span> isLeaf, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> endState = transfer(startState, offset); <span class="comment">//状态转移</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (base[endState].getTransferRatio() != BASE_NULL &amp;&amp; check[endState] != startState) &#123; <span class="comment">//已被占用</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            endState += <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (base[endState].getTransferRatio() != BASE_NULL);</span><br><span class="line"></span><br><span class="line">        base[startState].setTransferRatio(endState - offset); <span class="comment">//改变父节点转移基数</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isLeaf) &#123;</span><br><span class="line">        base[endState].setTransferRatio(Math.abs(base[startState].getTransferRatio())*-<span class="number">1</span>); <span class="comment">//叶子节点转移基数标识为父节点转移基数的相反数</span></span><br><span class="line">        base[endState].setLeaf(<span class="keyword">true</span>);</span><br><span class="line">        base[endState].setValue(idx); <span class="comment">//为叶子节点时需要记录下该词在字典中的索引号</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (base[endState].getTransferRatio() == BASE_NULL) &#123; <span class="comment">//未有节点经过</span></span><br><span class="line">            base[endState].setTransferRatio(Math.abs(base[startState].getTransferRatio())); <span class="comment">//非叶子节点的转移基数一定为正</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    check[endState] = startState;<span class="comment">//check中记录当前状态的父状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> base[endState];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="9-双数组字典树的查询"><a href="#9-双数组字典树的查询" class="headerlink" title="9.双数组字典树的查询"></a><strong>9.双数组字典树的查询</strong></h4><p>这里我写的比较简单，用<strong>正向匹配</strong>做的，这里比较关键的一句是这个</p>
<blockquote>
<p><code>base[endState].getTransferRatio() != BASE_NULL &amp;&amp; check[endState] == startState</code></p>
</blockquote>
<p>可以检测出节点是否在树上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/3/5 18:54</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 查询匹配项(正向匹配)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">match</span><span class="params">(String keyWord)</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; result = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">int</span> startState, endState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> chars[] = keyWord.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; chars.length; i++) &#123;</span><br><span class="line">        startState = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; chars.length; j++) &#123;</span><br><span class="line">            endState = transfer(startState, getCode(chars[j]));</span><br><span class="line">            <span class="keyword">if</span> (base[endState].getTransferRatio() != BASE_NULL &amp;&amp; check[endState] == startState) &#123; <span class="comment">//节点存在于 Trie 树上</span></span><br><span class="line">                <span class="keyword">if</span> (base[endState].isLeaf()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!result.contains(base[endState].getValue())) &#123;</span><br><span class="line">                        result.add(base[endState].getValue());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                startState = endState;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="10-双数组字典树测试"><a href="#10-双数组字典树测试" class="headerlink" title="10.双数组字典树测试"></a>10.<strong>双数组字典树测试</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; words = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    words.add(<span class="string">"清华"</span>);</span><br><span class="line">    words.add(<span class="string">"清华大学"</span>);</span><br><span class="line">    words.add(<span class="string">"清新"</span>);</span><br><span class="line">    words.add(<span class="string">"中华"</span>);</span><br><span class="line">    words.add(<span class="string">"中华人民"</span>);</span><br><span class="line">    words.add(<span class="string">"华人"</span>);</span><br><span class="line">    words.add(<span class="string">"学生"</span>);</span><br><span class="line">    words.add(<span class="string">"大学生"</span>);</span><br><span class="line">    words.add(<span class="string">"wo"</span>);</span><br><span class="line">    words.add(<span class="string">"shi"</span>);</span><br><span class="line">    words.add(<span class="string">"human"</span>);</span><br><span class="line">    words.add(<span class="string">"this"</span>);</span><br><span class="line">    words.add(<span class="string">"is"</span>);</span><br><span class="line">    words.add(<span class="string">"ragty"</span>);</span><br><span class="line">    words.add(<span class="string">"pump"</span>);</span><br><span class="line">    words.add(<span class="string">"it"</span>);</span><br><span class="line">    words.add(<span class="string">"up"</span>);</span><br><span class="line">    words.add(<span class="string">"中国"</span>);</span><br><span class="line">    words.add(<span class="string">"人名"</span>);</span><br><span class="line">    words.add(<span class="string">"中国人民"</span>);</span><br><span class="line">    words.add(<span class="string">"人民"</span>);</span><br><span class="line">    words.add(<span class="string">"java"</span>);</span><br><span class="line">    words.add(<span class="string">"java学习"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构建 Trie 树</span></span><br><span class="line">    DATrie daTrie = <span class="keyword">new</span> DATrie();</span><br><span class="line">    daTrie.build(words);</span><br><span class="line">    daTrie.printTrie();</span><br><span class="line"></span><br><span class="line">    String keyWord = <span class="string">"清华大学生都是华人"</span>;</span><br><span class="line">    List&lt;Integer&gt; result = daTrie.match(keyWord);</span><br><span class="line">    System.out.println();</span><br><span class="line">    System.out.println(<span class="string">"输入语句为："</span>+keyWord);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打印匹配结果</span></span><br><span class="line">    System.out.println();</span><br><span class="line">    System.out.printf(<span class="string">"Match: &#123;"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.size(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.printf(<span class="string">"%s"</span>, words.get(result.get(i)));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.printf(<span class="string">", %s"</span>, words.get(result.get(i)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.printf(<span class="string">"&#125;"</span>);</span><br><span class="line">    System.out.println();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="11-测试结果"><a href="#11-测试结果" class="headerlink" title="11.测试结果"></a><strong>11.测试结果</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  idx      <span class="number">0</span>	     <span class="number">98</span>	     <span class="number">99</span>	    <span class="number">100</span>	    <span class="number">104</span>	    <span class="number">105</span>	    <span class="number">106</span>	    <span class="number">107</span>	    <span class="number">108</span>	    <span class="number">109</span>	    <span class="number">110</span>	    <span class="number">111</span>	    <span class="number">112</span>	    <span class="number">113</span>	    <span class="number">114</span>	    <span class="number">115</span>	    <span class="number">116</span>	    <span class="number">117</span>	    <span class="number">118</span>	    <span class="number">119</span>	    <span class="number">120</span>	    <span class="number">121</span>	    <span class="number">122</span>	    <span class="number">123</span>	    <span class="number">124</span>	    <span class="number">125</span>	    <span class="number">126</span>	    <span class="number">127</span>	    <span class="number">128</span>	    <span class="number">129</span>	    <span class="number">130</span>	    <span class="number">131</span>	    <span class="number">132</span>	  <span class="number">20014</span>	  <span class="number">20099</span>	  <span class="number">20155</span>	  <span class="number">20156</span>	  <span class="number">20157</span>	  <span class="number">20158</span>	  <span class="number">21327</span>	  <span class="number">21328</span>	  <span class="number">21329</span>	  <span class="number">21518</span>	  <span class="number">22272</span>	  <span class="number">22824</span>	  <span class="number">22825</span>	  <span class="number">23399</span>	  <span class="number">23400</span>	  <span class="number">23401</span>	  <span class="number">23433</span>	  <span class="number">26034</span>	  <span class="number">27666</span>	  <span class="number">27668</span>	  <span class="number">27669</span>	  <span class="number">28166</span>	  <span class="number">29984</span>	  <span class="number">29986</span>	</span><br><span class="line"> <span class="keyword">char</span>   <span class="keyword">null</span>	      a	      a	      a	      g	      h	      i	      j	      h	      i	      h	      m	      o	      p	      n	      r	      s	      t	      u	      u	      w	      i	      s	      t	      u	      m	      t	      p	      y	      p	      v	      s	      a	      中	      习	      人	      人	      人	      人	      华	      华	      华	      名	      国	      大	      大	      学	      学	      学	      学	      新	      民	      民	      民	      清	      生	      生	</span><br><span class="line"> base      <span class="number">1</span>	      <span class="number">1</span>	      <span class="number">4</span>	     <span class="number">12</span>	      <span class="number">7</span>	      <span class="number">2</span>	     <span class="number">10</span>	      <span class="number">3</span>	      <span class="number">4</span>	     -<span class="number">4</span>	     <span class="number">16</span>	      <span class="number">2</span>	     -<span class="number">1</span>	      <span class="number">7</span>	     -<span class="number">4</span>	      <span class="number">1</span>	      <span class="number">4</span>	      <span class="number">6</span>	     <span class="number">15</span>	      <span class="number">2</span>	      <span class="number">1</span>	     <span class="number">16</span>	     -<span class="number">7</span>	      <span class="number">7</span>	     <span class="number">16</span>	     <span class="number">17</span>	    -<span class="number">10</span>	    -<span class="number">15</span>	     -<span class="number">7</span>	    -<span class="number">17</span>	     <span class="number">35</span>	    -<span class="number">16</span>	    -<span class="number">35</span>	      <span class="number">3</span>	    -<span class="number">35</span>	      <span class="number">1</span>	     -<span class="number">2</span>	      <span class="number">3</span>	      <span class="number">4</span>	      <span class="number">2</span>	     -<span class="number">2</span>	     -<span class="number">3</span>	     -<span class="number">1</span>	      <span class="number">4</span>	      <span class="number">3</span>	      <span class="number">2</span>	      <span class="number">1</span>	     -<span class="number">2</span>	      <span class="number">3</span>	     <span class="number">35</span>	     -<span class="number">2</span>	     -<span class="number">1</span>	     -<span class="number">3</span>	     -<span class="number">4</span>	      <span class="number">2</span>	     -<span class="number">1</span>	     -<span class="number">3</span>	</span><br><span class="line">check     -<span class="number">1</span>	    <span class="number">115</span>	    <span class="number">111</span>	    <span class="number">107</span>	     <span class="number">98</span>	      <span class="number">0</span>	      <span class="number">0</span>	      <span class="number">0</span>	    <span class="number">116</span>	    <span class="number">108</span>	    <span class="number">117</span>	    <span class="number">119</span>	    <span class="number">120</span>	      <span class="number">0</span>	     <span class="number">99</span>	      <span class="number">0</span>	      <span class="number">0</span>	      <span class="number">0</span>	      <span class="number">0</span>	    <span class="number">105</span>	      <span class="number">0</span>	    <span class="number">110</span>	    <span class="number">106</span>	    <span class="number">104</span>	    <span class="number">113</span>	    <span class="number">124</span>	    <span class="number">106</span>	    <span class="number">118</span>	    <span class="number">123</span>	    <span class="number">125</span>	    <span class="number">100</span>	    <span class="number">121</span>	    <span class="number">130</span>	      <span class="number">0</span>	  <span class="number">23433</span>	      <span class="number">0</span>	  <span class="number">21327</span>	  <span class="number">21329</span>	  <span class="number">22272</span>	      <span class="number">0</span>	  <span class="number">28166</span>	  <span class="number">20014</span>	  <span class="number">20155</span>	  <span class="number">20014</span>	      <span class="number">0</span>	  <span class="number">21328</span>	      <span class="number">0</span>	  <span class="number">22825</span>	  <span class="number">22824</span>	    <span class="number">132</span>	  <span class="number">28166</span>	  <span class="number">20155</span>	  <span class="number">20157</span>	  <span class="number">20158</span>	      <span class="number">0</span>	  <span class="number">23399</span>	  <span class="number">23401</span>	</span><br><span class="line"> leaf      否	      否	      否	      否	      否	      否	      否	      否	      否	      是	      否	      否	      是	      否	      是	      否	      否	      否	      否	      否	      否	      否	      是	      否	      否	      否	      是	      是	      是	      是	      否	      是	      是	      否	      是	      否	      是	      否	      否	      否	      是	      是	      是	      是	      否	      否	      否	      是	      否	      否	      是	      是	      是	      是	      否	      是	      是	</span><br><span class="line">  idx     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	      <span class="number">9</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	      <span class="number">8</span>	     -<span class="number">1</span>	     <span class="number">10</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     <span class="number">12</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     <span class="number">15</span>	     <span class="number">16</span>	     <span class="number">13</span>	     <span class="number">14</span>	     -<span class="number">1</span>	     <span class="number">11</span>	     <span class="number">21</span>	     -<span class="number">1</span>	     <span class="number">22</span>	     -<span class="number">1</span>	      <span class="number">5</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	      <span class="number">0</span>	      <span class="number">3</span>	     <span class="number">18</span>	     <span class="number">17</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	      <span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	      <span class="number">2</span>	     <span class="number">20</span>	      <span class="number">4</span>	     <span class="number">19</span>	     -<span class="number">1</span>	      <span class="number">6</span>	      <span class="number">7</span>	</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">输入语句为：清华大学生都是华人</span><br><span class="line"></span><br><span class="line">Match: &#123;清华, 清华大学, 大学生, 学生, 华人&#125;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="12-总结"><a href="#12-总结" class="headerlink" title="12.总结"></a><strong>12.总结</strong></h4><blockquote>
<p>我刚开始写的时候没有任何头绪，看到那两个公式一头雾水，查了很多博客也写得一知半解，而且没有公式解析和实现代码。经过查阅文献以及自己的思考，有了这篇文章，希望能帮到更多想了解<code>DATrie</code>的人。</p>
<p>任何事情你清楚他要解决的问题和实现原理后，会发现它很简单。就像<code>DATrie</code>，它的难点在于核心公式的理解以及对于冲突的解决方案。只要理解了这个，实现是很简单的一件事。</p>
</blockquote>
<br>

<h4 id="13-完整代码-可直接运行"><a href="#13-完整代码-可直接运行" class="headerlink" title="13.完整代码(可直接运行)"></a><strong>13.完整代码(可直接运行)</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dictionary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DATrie</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> ARRAY_SIZE = <span class="number">655350</span>;  <span class="comment">//数组大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> BASE_ROOT = <span class="number">1</span>;        <span class="comment">//base根节点状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> BASE_NULL = <span class="number">0</span>;        <span class="comment">//base空闲状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> CHECK_ROOT = -<span class="number">1</span>;      <span class="comment">//check根节点状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> CHECK_NULL = -<span class="number">2</span>;      <span class="comment">//check空闲状态</span></span><br><span class="line">    <span class="keyword">private</span> TrieNode base[];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> check[];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 16:05</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: DATrie节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> transferRatio; <span class="comment">//转移基数</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isLeaf = <span class="keyword">false</span>; <span class="comment">//是否为叶子节点</span></span><br><span class="line">        <span class="keyword">private</span> Character label = <span class="keyword">null</span>; <span class="comment">//节点标识即插入的字符本身</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> value = -<span class="number">1</span>; <span class="comment">//当该节点为叶子节点时关联的字典表中对应词条的索引号</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTransferRatio</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> transferRatio;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransferRatio</span><span class="params">(<span class="keyword">int</span> transferRatio)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.transferRatio = transferRatio;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLeaf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> isLeaf;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeaf</span><span class="params">(<span class="keyword">boolean</span> leaf)</span> </span>&#123;</span><br><span class="line">            isLeaf = leaf;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Character <span class="title">getLabel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> label;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLabel</span><span class="params">(Character label)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.label = label;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/10 19:37</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 构造DATrie</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(List&lt;String&gt; words)</span> </span>&#123;</span><br><span class="line">        init();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> shut = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> idx = <span class="number">0</span>; idx &lt; words.size(); idx++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> startState = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">char</span> chars[] = words.get(idx).toCharArray();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (shut == <span class="keyword">false</span>) &#123;</span><br><span class="line">                TrieNode node = insert(startState, getCode(chars[<span class="number">0</span>]), (chars.length == <span class="number">1</span>), idx);</span><br><span class="line">                node.setLabel(chars[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;chars.length; j++) &#123;</span><br><span class="line">                    startState = transfer(startState, getCode(chars[j-<span class="number">1</span>]));</span><br><span class="line">                    TrieNode node = insert(startState, getCode(chars[j]), (chars.length == j+<span class="number">1</span>), idx);</span><br><span class="line">                    node.setLabel(chars[j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (idx == words.size()-<span class="number">1</span> &amp;&amp; shut == <span class="keyword">false</span>) &#123;</span><br><span class="line">                idx = -<span class="number">1</span>;   <span class="comment">//因为开始的时候还有一个加的过程</span></span><br><span class="line">                shut = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 18:54</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 查询匹配项(正向匹配)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">match</span><span class="params">(String keyWord)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">int</span> startState, endState;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span> chars[] = keyWord.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; chars.length; i++) &#123;</span><br><span class="line">            startState = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; chars.length; j++) &#123;</span><br><span class="line">                endState = transfer(startState, getCode(chars[j]));</span><br><span class="line">                <span class="keyword">if</span> (base[endState].getTransferRatio() != BASE_NULL &amp;&amp; check[endState] == startState) &#123; <span class="comment">//节点存在于 Trie 树上</span></span><br><span class="line">                    <span class="keyword">if</span> (base[endState].isLeaf()) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!result.contains(base[endState].getValue())) &#123;</span><br><span class="line">                            result.add(base[endState].getValue());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    startState = endState;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 19:00</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 打印DATrie</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printTrie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"idx"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7d\t"</span>, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"char"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7c\t"</span>, base[i].getLabel());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"base"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7d\t"</span>, base[i].getTransferRatio());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"check"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7d\t"</span>, check[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"leaf"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7s\t"</span>, base[i].isLeaf() ? <span class="string">"是"</span> : <span class="string">"否"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"idx"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7d\t"</span>, base[i].getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 18:49</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 根据起始状态和转移技术插入新节点并返回插入的节点</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@param</span> startState 起始状态</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@param</span> offset  状态偏移量</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@param</span> isLeaf  是否为叶子节点</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@param</span> idx 当前节点在词典中的索引号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TrieNode <span class="title">insert</span><span class="params">(<span class="keyword">int</span> startState, <span class="keyword">int</span> offset, <span class="keyword">boolean</span> isLeaf, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> endState = transfer(startState, offset); <span class="comment">//状态转移</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (base[endState].getTransferRatio() != BASE_NULL &amp;&amp; check[endState] != startState) &#123; <span class="comment">//已被占用</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                endState += <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">while</span> (base[endState].getTransferRatio() != BASE_NULL);</span><br><span class="line"></span><br><span class="line">            base[startState].setTransferRatio(endState - offset); <span class="comment">//改变父节点转移基数</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isLeaf) &#123;</span><br><span class="line">            base[endState].setTransferRatio(Math.abs(base[startState].getTransferRatio())*-<span class="number">1</span>); <span class="comment">//叶子节点转移基数标识为父节点转移基数的相反数</span></span><br><span class="line">            base[endState].setLeaf(<span class="keyword">true</span>);</span><br><span class="line">            base[endState].setValue(idx); <span class="comment">//为叶子节点时需要记录下该词在字典中的索引号</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[endState].getTransferRatio() == BASE_NULL) &#123; <span class="comment">//未有节点经过</span></span><br><span class="line">                base[endState].setTransferRatio(Math.abs(base[startState].getTransferRatio())); <span class="comment">//非叶子节点的转移基数一定为正</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        check[endState] = startState;<span class="comment">//check中记录当前状态的父状态</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> base[endState];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 18:53</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 根据起始状态和转移基数返回结束状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">transfer</span><span class="params">(<span class="keyword">int</span> startState, <span class="keyword">int</span> offset)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.abs(base[startState].getTransferRatio())+offset; <span class="comment">//状态转移</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 19:13</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 获取base数组的下标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)c;<span class="comment">//这里必须大于0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 16:06</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 初始化DATrie（base，check数组全部初始化）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        base = <span class="keyword">new</span> TrieNode[ARRAY_SIZE];</span><br><span class="line">        check = <span class="keyword">new</span> <span class="keyword">int</span>[ARRAY_SIZE];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            TrieNode node = <span class="keyword">new</span> TrieNode();</span><br><span class="line">            node.setTransferRatio(BASE_NULL);</span><br><span class="line">            base[i] = node;</span><br><span class="line">            check[i] = CHECK_NULL;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TrieNode root = <span class="keyword">new</span> TrieNode();</span><br><span class="line">        root.setTransferRatio(BASE_ROOT);</span><br><span class="line">        base[<span class="number">0</span>] = root;</span><br><span class="line">        check[<span class="number">0</span>] = CHECK_ROOT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; words = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        words.add(<span class="string">"清华"</span>);</span><br><span class="line">        words.add(<span class="string">"清华大学"</span>);</span><br><span class="line">        words.add(<span class="string">"清新"</span>);</span><br><span class="line">        words.add(<span class="string">"中华"</span>);</span><br><span class="line">        words.add(<span class="string">"中华人民"</span>);</span><br><span class="line">        words.add(<span class="string">"华人"</span>);</span><br><span class="line">        words.add(<span class="string">"学生"</span>);</span><br><span class="line">        words.add(<span class="string">"大学生"</span>);</span><br><span class="line">        words.add(<span class="string">"wo"</span>);</span><br><span class="line">        words.add(<span class="string">"shi"</span>);</span><br><span class="line">        words.add(<span class="string">"human"</span>);</span><br><span class="line">        words.add(<span class="string">"this"</span>);</span><br><span class="line">        words.add(<span class="string">"is"</span>);</span><br><span class="line">        words.add(<span class="string">"ragty"</span>);</span><br><span class="line">        words.add(<span class="string">"pump"</span>);</span><br><span class="line">        words.add(<span class="string">"it"</span>);</span><br><span class="line">        words.add(<span class="string">"up"</span>);</span><br><span class="line">        words.add(<span class="string">"中国"</span>);</span><br><span class="line">        words.add(<span class="string">"人名"</span>);</span><br><span class="line">        words.add(<span class="string">"中国人民"</span>);</span><br><span class="line">        words.add(<span class="string">"人民"</span>);</span><br><span class="line">        words.add(<span class="string">"java"</span>);</span><br><span class="line">        words.add(<span class="string">"java学习"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建 Trie 树</span></span><br><span class="line">        DATrie daTrie = <span class="keyword">new</span> DATrie();</span><br><span class="line">        daTrie.build(words);</span><br><span class="line">        daTrie.printTrie();</span><br><span class="line"></span><br><span class="line">        String keyWord = <span class="string">"清华大学生都是华人"</span>;</span><br><span class="line">        List&lt;Integer&gt; result = daTrie.match(keyWord);</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">"输入语句为："</span>+keyWord);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打印匹配结果</span></span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"Match: &#123;"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%s"</span>, words.get(result.get(i)));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.printf(<span class="string">", %s"</span>, words.get(result.get(i)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">"&#125;"</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h5 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h5><p>1.<a href="https://segmentfault.com/a/1190000008877595" target="_blank" rel="noopener">小白详解Trie树</a><br>2.<a href="http://www.cnki.com.cn/Article/CJFDTotal-RJDK201207007.htm" target="_blank" rel="noopener">《基于双数组Ｔｒｉｅ树算法的字典改进和实现》</a><br>3.<a href="https://www.semanticscholar.org/paper/An-Efficient-Implementation-of-Trie-Structures-Aoe-Morimoto/f2ad2a67218e458a979afafb311d1d7867f3f624" target="_blank" rel="noopener">Theppitak Karoonboonyanan, An Implementation of Double-Array Trie.</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/blog/2020/02/25/%E5%AD%97%E5%85%B8%E6%A0%91%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%8F%8A%E5%AE%9E%E7%8E%B0(%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87%E6%8F%92%E5%85%A5)/">字典树原理分析及实现(支持中文插入)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/blog/categories/NLP/">NLP</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/blog/tags/%E7%AE%97%E6%B3%95-%E5%AD%97%E5%85%B8%E6%A0%91-%E5%AD%97%E5%85%B8%E6%A0%91%E5%8E%9F%E7%90%86/">算法 字典树 字典树原理</a></span><div class="content"><a id="more"></a>

<h5 id="1-背景"><a href="#1-背景" class="headerlink" title="1.背景"></a>1.背景</h5><p>匹配算法的瓶颈之一在于<strong>如何判断字典中是否含有字符串</strong>，如果用的是有序集合(<code>TreeMap</code>)的话，复杂度是<code>O(logn)</code>，如果用散列表(<code>HashMap</code>)，账面上的时间复杂度虽然下降了，但内存复杂度上去了。我们要寻找一种速度又快，又省内存的数据结构。</p>
<br>

<h5 id="2-字典树概念："><a href="#2-字典树概念：" class="headerlink" title="2.字典树概念："></a>2.字典树概念：</h5><blockquote>
<p>又称单词查找树，<a href="https://baike.baidu.com/item/Trie%E6%A0%91" target="_blank" rel="noopener">Trie树</a>，是一种<a href="https://baike.baidu.com/item/%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84/9663807" target="_blank" rel="noopener">树形结构</a>，是一种哈希树的变种。典型应用是用于统计，排序和保存大量的<a href="https://baike.baidu.com/item/%E5%AD%97%E7%AC%A6" target="_blank" rel="noopener">字符</a>串（但不仅限于字符串），所以经常被搜索引擎系统用于文本词频统计。（看图马上理解）</p>
</blockquote>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcuNTF3ZW5kYW5nLmNvbS9waWMvMWNhM2M3NGZmYzNhZTE3MzIxNzZiNzYxLzItODEwLWpwZ182LTEwODAtMC0wLTEwODAuanBn?x-oss-process=image/format,png" alt=""></p>
<br>

<h5 id="3-字典树特点："><a href="#3-字典树特点：" class="headerlink" title="3.字典树特点："></a><strong>3.字典树特点</strong>：</h5><ul>
<li>根节点不包含字符，除根节点外每一个节点都只包含一个字符</li>
<li>从根节点到某一节点，路径上经过的字符连接起来，为该节点对应的字符串</li>
<li>每个节点的所有子节点包含的字符都不相同</li>
</ul>
<br>

<h5 id="4-字典树的实现原理："><a href="#4-字典树的实现原理：" class="headerlink" title="4.字典树的实现原理："></a><strong>4.字典树的实现原理</strong>：</h5><p>从确定有限状态自动机(DFA)的角度来讲，每个节点都是一个状态，状态表示当前已经查询到的前缀。从父节点到子节点的移动过程可以看作一次<code>状态转移</code>。以下是查询步骤：</p>
<ul>
<li>我们输入一个想要查询的词，如果有满足条件的边，状态转移；如果找不到，直接失败</li>
<li>完成了全部转移时，拿到了最后一个字符的状态，询问该状态是否为<strong>终点状态</strong>，如果是则查到了单词，否则该单词不在字典中</li>
</ul>
<p>“删改改查”都是一回事，以下不再赘述</p>
<br>

<h5 id="5-字典树节点结构："><a href="#5-字典树节点结构：" class="headerlink" title="5.字典树节点结构："></a><strong>5.字典树节点结构</strong>：</h5><p>这里我们用<code>HashMap</code>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span> Ragty</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>  字典树节点</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Date</span>   2020/2/27 0:00</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> path;        <span class="comment">//表示多少个词共用该前缀</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> status;</span><br><span class="line">    <span class="keyword">public</span> HashMap&lt;Character, TrieNode&gt; map;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TrieNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        path = <span class="number">0</span>;</span><br><span class="line">        status = <span class="keyword">false</span>;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h5 id="6-字典树的实现："><a href="#6-字典树的实现：" class="headerlink" title="6.字典树的实现："></a><strong>6.字典树的实现</strong>：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TrieNode root;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/2/27 0:01</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 初始化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TrieTree1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    root = <span class="keyword">new</span> TrieNode();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/2/27 0:02</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 插入节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (word == <span class="keyword">null</span> || word.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    TrieNode node = root;</span><br><span class="line">    node.path++;</span><br><span class="line">    <span class="keyword">char</span>[] words = word.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.map.get(words[i]) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            node.map.put(words[i], <span class="keyword">new</span> TrieNode());</span><br><span class="line">        &#125;</span><br><span class="line">        node = node.map.get(words[i]);</span><br><span class="line">        node.path++;</span><br><span class="line">    &#125;</span><br><span class="line">    node.status = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/2/27 0:02</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 寻找节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (word == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    TrieNode node = root;</span><br><span class="line">    <span class="keyword">char</span>[] words = word.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.map.get(words[i]) == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        node = node.map.get(words[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node.status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/2/27 0:06</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 删除节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (search(word)) &#123;</span><br><span class="line">        <span class="keyword">char</span>[] words = word.toCharArray();</span><br><span class="line">        TrieNode node = root;</span><br><span class="line">        node.path--;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (--node.map.get(words[i]).path == <span class="number">0</span>) &#123;</span><br><span class="line">                node.map.remove(words[i]);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            node = node.map.get(words[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/2/27 0:07</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 前缀遍历，若有前缀，返回它最后一个节点的path</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">prefixNumber</span><span class="params">(String pre)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pre == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    TrieNode node = root;</span><br><span class="line">    <span class="keyword">char</span>[] pres = pre.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pres.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.map.get(pres[i]) == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        node = node.map.get(pres[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node.path;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/2/27 0:50</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 前序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preWalk</span><span class="params">(TrieNode root)</span> </span>&#123;</span><br><span class="line">    TrieNode node = root;</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;Character,TrieNode&gt; map : root.map.entrySet()) &#123;</span><br><span class="line">        node = map.getValue();</span><br><span class="line">        <span class="keyword">if</span> (node != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(map.getKey());</span><br><span class="line">            preWalk(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> TrieNode <span class="title">getRoot</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h5 id="7-测试："><a href="#7-测试：" class="headerlink" title="7.测试："></a>7.<strong>测试</strong>：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    TrieTree1 trieTree = <span class="keyword">new</span> TrieTree1();</span><br><span class="line"></span><br><span class="line">    trieTree.insert(<span class="string">"字典树"</span>);</span><br><span class="line">    trieTree.insert(<span class="string">"字典书"</span>);</span><br><span class="line">    trieTree.insert(<span class="string">"字典"</span>);</span><br><span class="line">    trieTree.insert(<span class="string">"天气"</span>);</span><br><span class="line">    trieTree.insert(<span class="string">"气人"</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(trieTree.search(<span class="string">"字典"</span>));</span><br><span class="line">    System.out.println(trieTree.search(<span class="string">"字"</span>));</span><br><span class="line">    System.out.println(trieTree.prefixNumber(<span class="string">"字典树"</span>));</span><br><span class="line"></span><br><span class="line">    TrieNode root = trieTree.getRoot();</span><br><span class="line"></span><br><span class="line">    trieTree.preWalk(root);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h5 id="8-测试结果："><a href="#8-测试结果：" class="headerlink" title="8.测试结果："></a><strong>8.测试结果</strong>：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">true</span></span><br><span class="line"><span class="keyword">false</span></span><br><span class="line">气--人--字--典--树--书--天--气</span><br></pre></td></tr></table></figure>

<br>

<h5 id="9-算法分析："><a href="#9-算法分析：" class="headerlink" title="9.算法分析："></a><strong>9.算法分析</strong>：</h5><p>当字典大小为n时，虽然最坏情怀下字典树的复杂度依然是O(logn)。但它的实际速度比二分查找快，这是因为随着路径的深入，前缀匹配是递进的过程，算法不必比较字符串的前缀，因此可以节省很多用来比较的时间。</p>
<br>

<h5 id="10-算法改进："><a href="#10-算法改进：" class="headerlink" title="10.算法改进："></a><strong>10.算法改进</strong>：</h5><p>这里我们查询某个词的时候还需要逐个对比，若我们将对象转换为散列值，散列函数输出区间为[0,65535]之间的整数，这时候我们直接访问下标就可以访问到对应的字符，不过这种做法只适用于第一行，否则会内存指数膨胀，后边的按数组存放即可，查询时直接二分法查询。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/blog/2020/02/14/%E8%AF%8D%E5%85%B8%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E8%AF%A6%E8%A7%A3/">词典分词算法实现详解</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-14</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/blog/categories/NLP/">NLP</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/blog/tags/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86-%E8%AF%8D%E5%85%B8%E5%88%86%E8%AF%8D-%E6%AD%A3%E5%90%91%E6%9C%80%E9%95%BF%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95-%E9%80%86%E5%90%91%E6%9C%80%E9%95%BF%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95-%E5%8F%8C%E5%90%91%E6%9C%80%E9%95%BF%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/">自然语言处理 词典分词 正向最长匹配算法 逆向最长匹配算法 双向最长匹配算法</a></span><div class="content"><a id="more"></a>

<h6 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h6><p><code>中文分词</code>指的是将一段文本拆分为一系列单词的过程，这是中文信息处理的第一站，中文分词备受关注。中文分词大致分为以下两类：</p>
<ul>
<li><strong>基于词典规则</strong></li>
<li><strong>基于机器学习</strong></li>
</ul>
<p>这里我们主要介绍词典分词</p>
<br>

<h6 id="2-词典分词"><a href="#2-词典分词" class="headerlink" title="2.词典分词"></a>2.词典分词</h6><p><strong>词典分词</strong>是最简单，最常见的分词算法，需要的材料为：</p>
<ul>
<li><strong>一部词典</strong></li>
<li><strong>一套查词典的规则</strong></li>
</ul>
<p>简单来说，词典分词就是一个确定的查词与输出的规则系统。词典分词的重点不在于分词本身，而在于<strong>支撑词典的数据结构</strong>。</p>
<br>

<h6 id="3-词典分类及加载"><a href="#3-词典分类及加载" class="headerlink" title="3.词典分类及加载"></a>3.词典分类及加载</h6><p>互联网上有许多公开的中文词典，比如搜狗实验室发布的互联网词库<code>SogouW</code>，清华大学开放中文词库<code>THUOCL</code>，以及千万级巨型汉语词库<code>HanLP</code>。我们这里用<code>HanLP</code></p>
<br>

<p><code>HanLP</code>中词典的格式是一种以空格分隔的表格形式，第一列是单词本身，之后表示词性与相应的词频，下面举个栗子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">希望  v  <span class="number">386</span>  n <span class="number">96</span></span><br><span class="line">希罕  a  <span class="number">1</span></span><br><span class="line">希冀  v  <span class="number">1</span></span><br></pre></td></tr></table></figure>



<p>下载的话，需要先下载好<code>HanLP</code>的数据包，推荐从<code>码云</code>直接<a href="https://gitee.com/weiyy153/HanLP/tree/1.x/data">下载</a>，<code>GitHub</code>很慢。</p>
<p>加载的话很简单，我们把下载好的数据包放在<code>src</code>目录下，只需要以下的代码即可完成字典的加载：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TreeMap&lt;String,CoreDictionary.Attribute&gt; dictionary = IOUtil.loadDictionary(<span class="string">"src/HanLP/data/dictionary/CoreNatureDictionary.mini.txt"</span>);</span><br></pre></td></tr></table></figure>

<br>

<h6 id="4-词典切分算法"><a href="#4-词典切分算法" class="headerlink" title="4.词典切分算法"></a>4.词典切分算法</h6><p>词典确定之后，<strong>句子中可能含有很多词典中的词语</strong>。它们可能相互重叠，到底输出哪一个由规定的规则决定。常用的规则有以下几种（都基于完全切分过程）：</p>
<ul>
<li><strong>完全切分算法</strong></li>
<li><strong>正向最长匹配算法</strong></li>
<li><strong>逆向最长匹配算法</strong></li>
<li><strong>双向最长匹配算法</strong></li>
</ul>
<br>

<h6 id="5-完全切分算法"><a href="#5-完全切分算法" class="headerlink" title="5. 完全切分算法"></a>5. 完全切分算法</h6><p>  <code>核心思想</code>：找出一段文本中的所有单词。</p>
<p>  <code>代码实现</code>：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/2/9 21:38</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 完全切分式的中文算法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">segmentFully</span><span class="params">(String text, TreeMap&lt;String, CoreDictionary.Attribute&gt; dictionary)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; wordList = <span class="keyword">new</span> LinkedList&lt;String&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt; text.length(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;=text.length(); j++)</span><br><span class="line">        &#123;</span><br><span class="line">            String word = text.substring(i,j);</span><br><span class="line">            <span class="keyword">if</span> (dictionary.containsKey(word))</span><br><span class="line">            &#123;</span><br><span class="line">                wordList.add(word);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wordList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <code>单元测试</code>：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(segmentFully(<span class="string">"就读北京大学"</span>, dictionary));</span><br></pre></td></tr></table></figure>

<p>  <code>测试结果</code>：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[就, 就读, 读, 北, 北京, 北京大学, 京, 大, 大学, 学]</span><br></pre></td></tr></table></figure>

<p>  <code>结果分析</code>:</p>
<p>  以上的输出并不是中文分词，我们需要的是有意义的词语序列，而不是所有出现在字典中的单词所构成的列表，我们需要完善这个规则。</p>
<br>

<h6 id="6-正向最长匹配算法"><a href="#6-正向最长匹配算法" class="headerlink" title="6.正向最长匹配算法"></a>6.正向最长匹配算法</h6><p>  <code>核心思想</code>：考虑到越长的单词表达的意义越丰富，于是是我们定义单词越长优先级越高。就是在全切分的基础上添加<strong>优先输出更长的单词且扫描顺序为从前往后</strong>的规则。</p>
<p>  <code>代码实现</code>：​    </p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/2/9 22:11</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 正向最长匹配中文分词算法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">segmentForwardLongest</span> <span class="params">(String text, TreeMap&lt;String, CoreDictionary.Attribute&gt; dictionary)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; wordList = <span class="keyword">new</span> LinkedList&lt;String&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt; text.length(); )</span><br><span class="line">    &#123;</span><br><span class="line">        String longestWord = text.substring(i,i+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;=text.length(); j++)</span><br><span class="line">        &#123;</span><br><span class="line">            String word = text.substring(i,j);</span><br><span class="line">            <span class="keyword">if</span> (dictionary.containsKey(word))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (word.length() &gt; longestWord.length())</span><br><span class="line">                &#123;</span><br><span class="line">                    longestWord = word;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        wordList.add(longestWord);</span><br><span class="line">        i += longestWord.length();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> wordList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <code>单元测试</code>：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(segmentForwardLongest(<span class="string">"就读北京大学"</span>,dictionary));</span><br><span class="line">System.out.println(segmentForwardLongest(<span class="string">"研究生命起源"</span>,dictionary));</span><br></pre></td></tr></table></figure>

<p>  <code>测试结果</code>：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[就读, 北京大学]</span><br><span class="line">[研究生, 命, 起源]</span><br></pre></td></tr></table></figure>

<p>  <code>结果分析</code>：</p>
<p>  前一个结果更加符合预期了，但是在第二个实例中，研究生的优先级是大于研究的。我们需要解决这个优先级的冲突。</p>
  <br>

<h6 id="7-逆向最长匹配"><a href="#7-逆向最长匹配" class="headerlink" title="7.逆向最长匹配"></a>7.逆向最长匹配</h6><p>  <code>核心思想</code>：与正向匹配的唯一区别在于扫描的方向</p>
<p>  <code>代码实现</code>：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>:  22:25</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 逆向最长匹配的中文分词算法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">segmentBackwardLongest</span> <span class="params">(String text, TreeMap&lt;String, CoreDictionary.Attribute&gt; dictionary)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; wordList = <span class="keyword">new</span> LinkedList&lt;String&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=text.length()-<span class="number">1</span> ; i &gt;= <span class="number">0</span>; )</span><br><span class="line">    &#123;</span><br><span class="line">        String longestWord = text.substring(i,i+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;=i; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            String word = text.substring(j,i+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (dictionary.containsKey(word))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (word.length() &gt; longestWord.length())</span><br><span class="line">                &#123;</span><br><span class="line">                    longestWord = word;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        wordList.add(<span class="number">0</span>,longestWord);</span><br><span class="line">        i -= longestWord.length();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> wordList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <code>单元测试</code>：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(segmentBackwardLongest(<span class="string">"研究生命起源"</span>,dictionary));</span><br><span class="line">System.out.println(segmentBackwardLongest(<span class="string">"项目的研究"</span>,dictionary));</span><br></pre></td></tr></table></figure>

<p>  <code>测试结果</code>：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[研究, 生命, 起源]</span><br><span class="line">[项，目的，研究]</span><br></pre></td></tr></table></figure>

<p>  <code>结果分析</code>：</p>
<p>  虽然逆向最长匹配算法能解决一些问题，但同时也出现了新的问题。</p>
  <br>

<h6 id="8-双向最长匹配"><a href="#8-双向最长匹配" class="headerlink" title="8.双向最长匹配"></a>8.双向最长匹配</h6><p>  <code>核心思想</code>：综合前两种规则，取长补短。规则如下所述</p>
<ul>
<li><p>同时执行正向和逆向最长匹配，若两者词数不同，则返回次数更少的一个</p>
</li>
<li><p>否则，返回两者中单字最少的那一个。单子数目相同时，优先返回逆向最长匹配的结果</p>
<p><code>代码实现</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/2/9 22:29</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 统计分词中的单字数量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">countingSingleChar</span><span class="params">(List&lt;String&gt; wordList)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (String word : wordList)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (word.length() == <span class="number">1</span>)</span><br><span class="line">            size++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/2/9 22:37</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 双向最长匹配的中文分词算法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">segmentBidirectional</span> <span class="params">(String text, TreeMap&lt;String, CoreDictionary.Attribute&gt; dictionary)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    List&lt;String&gt; forwardLongest = segmentForwardLongest(text, dictionary);</span><br><span class="line">    List&lt;String&gt; backwardLongest = segmentBackwardLongest(text, dictionary);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (forwardLongest.size() &lt; backwardLongest.size())</span><br><span class="line">        <span class="keyword">return</span> forwardLongest;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (forwardLongest.size() &gt; backwardLongest.size())</span><br><span class="line">        <span class="keyword">return</span> backwardLongest;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (countingSingleChar(forwardLongest) &lt; countingSingleChar(backwardLongest))</span><br><span class="line">            <span class="keyword">return</span> forwardLongest;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> backwardLongest;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>单元测试</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(segmentBidirectional(<span class="string">"研究生命起源"</span>,dictionary));</span><br></pre></td></tr></table></figure>

<p><code>测试结果</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[研究, 生命, 起源]</span><br></pre></td></tr></table></figure>

<p><code>结果分析</code>：</p>
<p>调用了两次匹配算法，所以速度上较慢，而且很多时候是帮倒忙，不实用</p>
</li>
</ul>
<br>

<h6 id="9-匹配规则效果对比"><a href="#9-匹配规则效果对比" class="headerlink" title="9.匹配规则效果对比"></a>9.匹配规则效果对比</h6><table>
<thead>
<tr>
<th>序号</th>
<th>原文</th>
<th>正向最长匹配</th>
<th>逆向最长匹配</th>
<th>双向最长匹配</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>项目的研究</td>
<td><strong>[项目，的，研究]</strong></td>
<td>[项，目的，研究]</td>
<td>[项，目的，研究]</td>
</tr>
<tr>
<td>2</td>
<td>商品和服务</td>
<td>[商品，和服，务]</td>
<td><strong>[商品，和，服务]</strong></td>
<td><strong>[商品，和，服务]</strong></td>
</tr>
<tr>
<td>3</td>
<td>研究生命起源</td>
<td>[研究生，命, 起源]</td>
<td><strong>[研究, 生命, 起源]</strong></td>
<td><strong>[研究, 生命, 起源]</strong></td>
</tr>
</tbody></table>
<br>

<h6 id="10-词典切分算法总结"><a href="#10-词典切分算法总结" class="headerlink" title="10.词典切分算法总结"></a>10.词典切分算法总结</h6><p>由以上的表格分析，规则系统的脆弱可见一斑。规则集的维护又是是拆东墙补西墙，有时会帮倒忙。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/blog/2020/02/10/NLP%E6%A6%82%E8%BF%B0/">NLP概述</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-10</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/blog/categories/NLP/">NLP</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/blog/tags/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86/">自然语言处理</a></span><div class="content"><a id="more"></a>

<h6 id="1-基础概念"><a href="#1-基础概念" class="headerlink" title="1.基础概念"></a>1.基础概念</h6><p>自然语言处理（Nature Language Processing，NLP）是一门融合了计算机科学，人工智能以及语言学的交叉学科。<br><br></p>
<h6 id="2-研究目标"><a href="#2-研究目标" class="headerlink" title="2.研究目标"></a>2.研究目标</h6><p>通过机器学习等技术，<strong>让计算机学会处理人类语言</strong>，乃至实现终极目标——理解人类语言或人工智能。</p>
<br>

<h6 id="3-自然语言的处理层次"><a href="#3-自然语言的处理层次" class="headerlink" title="3.自然语言的处理层次"></a>3.自然语言的处理层次</h6><ul>
<li><p><strong>语音、图像和文本</strong></p>
<p>自然语言处理系统的输入源一共有3个，语音，图像和文本，但前两者存储的信息总量没有文本多，所以需要先<strong>转换为文本</strong>再处理，转换分别称为语音识别(Speech Recognition)和光学字符识别(OCR)。</p>
</li>
<li><p><strong>词法分析</strong></p>
<p>主要任务是<strong>将文本分隔为有意义的词语 **(中文分词)，</strong>消除每个词语的歧义<strong>(词性标注)，再</strong>识别出一些特殊的专有名词**(命名体识别)。</p>
</li>
<li><p><strong>信息抽取</strong></p>
<p>词法分析之后，文本已经呈现结构化趋势。显示为有意义的单词列表。根据单词与标签，我们可以抽取出一部分有用的信息，从简单的高频词到高级算法<strong>提取关键词</strong>。</p>
</li>
<li><p><strong>句法分析</strong></p>
<p>词法分析只能得到零散的词汇信息，计算机不知道词语之间的关系。句法分析的目标就是，<strong>得到句子中词语之间的关系</strong>。</p>
</li>
<li><p><strong>语义分析与篇章分析</strong></p>
<p>相对于句法分析来看，语义分析侧重于语义而非语法，它包括<strong>词义消歧</strong>(确定一个词在语境中的含义)、<strong>语义角色标注</strong>(标注句子中谓语与其他成分的关系)，<strong>语义依存分析</strong>(分析句子中词语之间的关系)</p>
</li>
</ul>
<br>

<h6 id="4-自然语言处理的流派"><a href="#4-自然语言处理的流派" class="headerlink" title="4.自然语言处理的流派"></a>4.自然语言处理的流派</h6><ul>
<li><p><strong>基于规则的专家系统</strong></p>
<p>设计专家针对需求而设计许多规则组成的系统，比较死板僵硬与不稳定。</p>
</li>
<li><p><strong>基于统计学的方法</strong></p>
<p>收集制作<code>语料库</code>，让机器根据语料库自动学习这些规则（与机器学习相结合）</p>
</li>
</ul>
<br>

<h6 id="5-总结"><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h6><p>机器学习是人工智能的子集，而NLP则是人工智能与语言学，计算机科学的交集。这个交集虽然小，它的难度却很大。为了实现理解自然语言这个宏伟目标，人们尝试了规则系统，并最终发展到基于大规模语料库的<code>统计学习系统</code>。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/blog/2019/12/18/Spring%20boot%20%E5%88%86%E9%A1%B5%E6%96%B9%E6%B3%95%E8%BF%87%E6%97%B6%E8%A7%A3%E5%86%B3/">Spring boot 分页方法过时解决</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-18</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/blog/categories/spring-boot/">spring boot</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/blog/tags/jpa%E5%88%86%E9%A1%B5%E8%BF%87%E6%97%B6-spring-boot-sort-PageRequest/">jpa分页过时 spring boot sort PageRequest</a></span><div class="content"><a id="more"></a>

<h4 id="1-问题表现"><a href="#1-问题表现" class="headerlink" title="1.问题表现"></a>1.问题表现</h4><p>源代码为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Sort sort = <span class="keyword">new</span> Sort(Sort.Direction.DESC, <span class="string">"login_time"</span>);</span><br><span class="line">Pageable pageable = <span class="keyword">new</span> PageRequest(Integer.parseInt(page), Integer.parseInt(size), sort);</span><br></pre></td></tr></table></figure>

<p>报错代码为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'Sort(org.springframework.data.domain.Sort.Direction,java.util.List&lt;java.lang.String&gt;)'</span> has <span class="keyword">private</span> access in <span class="string">'org.springframework.data.domain.Sort'</span></span><br><span class="line"></span><br><span class="line">PageRequest(<span class="keyword">int</span>, <span class="keyword">int</span>, org.springframework.data.domain.Sort)<span class="string">' has protected access in '</span>org.springframework.data.domain.PageRequest</span><br></pre></td></tr></table></figure>

<br>

<h4 id="2-问题分析"><a href="#2-问题分析" class="headerlink" title="2.问题分析"></a>2.问题分析</h4><p>很明显，Spring Boot新版本中已经升级相关的类，不支持原来的写法了。</p>
<p>以<code>Sort</code>为例，我们看一下他的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sort</span> <span class="keyword">implements</span> <span class="title">Streamable</span>&lt;<span class="title">Sort</span>.<span class="title">Order</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">5737186511678863905L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Sort UNSORTED = by();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Sort.Direction DEFAULT_DIRECTION;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Sort.Order&gt; orders;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Sort</span><span class="params">(Sort.Direction direction, List&lt;String&gt; properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (properties != <span class="keyword">null</span> &amp;&amp; !properties.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.orders = (List)properties.stream().map((it) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Sort.Order(direction, it);</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"You have to provide at least one property to sort by!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sort <span class="title">by</span><span class="params">(String... properties)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(properties, <span class="string">"Properties must not be null!"</span>);</span><br><span class="line">        <span class="keyword">return</span> properties.length == <span class="number">0</span> ? unsorted() : <span class="keyword">new</span> Sort(DEFAULT_DIRECTION, Arrays.asList(properties));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sort <span class="title">by</span><span class="params">(List&lt;Sort.Order&gt; orders)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(orders, <span class="string">"Orders must not be null!"</span>);</span><br><span class="line">        <span class="keyword">return</span> orders.isEmpty() ? unsorted() : <span class="keyword">new</span> Sort(orders);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sort <span class="title">by</span><span class="params">(Sort.Order... orders)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(orders, <span class="string">"Orders must not be null!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Sort(Arrays.asList(orders));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sort <span class="title">by</span><span class="params">(Sort.Direction direction, String... properties)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(direction, <span class="string">"Direction must not be null!"</span>);</span><br><span class="line">        Assert.notNull(properties, <span class="string">"Properties must not be null!"</span>);</span><br><span class="line">        Assert.isTrue(properties.length &gt; <span class="number">0</span>, <span class="string">"At least one property must be given!"</span>);</span><br><span class="line">        <span class="keyword">return</span> by((List)Arrays.stream(properties).map((it) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Sort.Order(direction, it);</span><br><span class="line">        &#125;).collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>这里<code>Sort</code>的属性已有原来的public变为private了</strong>，而且我们原来的方法变更为Sort.by()</p>
<p>同理，<strong>PageRequest的原有的属性由public变为procted</strong></p>
<br>

<h4 id="3-解决方案"><a href="#3-解决方案" class="headerlink" title="3.解决方案"></a>3.解决方案</h4><p>按照新版本源码提供的方案修改即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Sort sort = Sort.by(Sort.Order.desc(<span class="string">"create_date"</span>));</span><br><span class="line">Pageable pageable =PageRequest.of(Integer.parseInt(page), Integer.parseInt(size), sort);</span><br></pre></td></tr></table></figure>


</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/blog/2019/11/26/CRC%E5%BE%AA%E7%8E%AF%E5%86%97%E4%BD%99%E6%A0%A1%E9%AA%8C%E7%A0%81%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90(%E9%99%84%E5%AE%9E%E4%BE%8B)/">CRC循环冗余校验码原理解析(附实例)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/blog/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/blog/tags/CRC-%E5%BE%AA%E7%8E%AF%E5%86%97%E4%BD%99%E6%A0%A1%E9%AA%8C%E7%A0%81-CRC%E5%BE%AA%E7%8E%AF%E5%86%97%E4%BD%99%E6%A0%A1%E9%AA%8C%E7%A0%81/">CRC 循环冗余校验码 CRC循环冗余校验码</a></span><div class="content"><a id="more"></a>



<h4 id="1-CRC简介"><a href="#1-CRC简介" class="headerlink" title="1.CRC简介"></a>1.CRC简介</h4><p><code>CRC循环冗余校验码</code>是数据通信中的一种查错校验码。</p>
<br>

<h4 id="2-CRC原理"><a href="#2-CRC原理" class="headerlink" title="2.CRC原理"></a>2.CRC原理</h4><p>CRC 算法的基本思想是将传输的数据<code>[M(X)]</code> 当做一个位数很长的数。将这个数除以另一个数[G(X)] ,得到的余数[R(X)] 作为校验数据附加到原数据后面,组成循环校验码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">M(X)代表待编码的有效信息</span><br><span class="line">G(X)代表约定好的多项式</span><br><span class="line">R(X)代表代表检验位</span><br></pre></td></tr></table></figure>

<p>由于，<strong>CRC的结构 = 信息位(N位) + 校验位(K位)</strong></p>
<p>所以，<strong>CRC编码 = M(X) + R(X)</strong></p>
<br>

<h4 id="3-CRC编码方法"><a href="#3-CRC编码方法" class="headerlink" title="3.CRC编码方法"></a>3.CRC编码方法</h4><ul>
<li><p>把待编码的N位有效信息位表示为多项式M(X)</p>
</li>
<li><p>把M(X)左移K位，得到<code>M(X)*X^K</code>，这样就空出了K位，以便拼接K位余数，<strong>这里的<code>K</code>位是由多项式<code>G(X)</code>的最高位决定的</strong></p>
</li>
<li><p>选取一个生成多项式G(x)，对<code>M(X)*X^K</code>做<strong>模二除</strong> (多项式G(X)一般会直接给你，模二除看下面例子，<strong>实质是异或运算</strong>)，以下是运算公式</p>
<p><strong>( <code>M(X) * X^K</code> ) / G(X) = Q(X) + R(X) / G(X)</strong></p>
<p>这里的<code>Q(X)</code>是商，它本身不重要，<strong>这里最重要的是求出余数<code>R(X)</code></strong></p>
</li>
<li><p>将信息位M(X)与余数R(X)拼接起来，构成CRC循环冗余校验码</p>
<p><strong>CRC编码 = M(X) + R(X)</strong></p>
</li>
</ul>
<br>

<h4 id="4-举个栗子"><a href="#4-举个栗子" class="headerlink" title="4.举个栗子"></a>4.举个栗子</h4><p>题目：<strong>选择产生多项式位1011，把4位有效信息1100编成CRC码</strong></p>
<ul>
<li><p>M(X) = X^3 + X^2 = 1100</p>
</li>
<li><p>M(X) * X^3 = X^6 + X^5 = 1100000 （<strong>这里多项式最高位位3，左移3位</strong>）</p>
</li>
<li><p>G(X) = X^3 +X +1 = 1011</p>
</li>
<li><p>( <code>M(X) * X^K</code> ) / G(X) = 1100000 / 1011 =  1110 + <code>010</code> / 1011 (<strong>关键</strong>，这里进行模二运算，<strong>实质上是异或运算</strong>，求<code>R(X)</code>)<br><img src="https://img-blog.csdnimg.cn/20191126153117465.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"> 经运算，此时确定R(X)为 <code>010</code></p>
</li>
<li><p>此时得出CRC编码 = M(X) + R(X) = 1100010</p>
</li>
</ul>
<br>

<h4 id="5-CRC编码的校验"><a href="#5-CRC编码的校验" class="headerlink" title="5.CRC编码的校验"></a>5.CRC编码的校验</h4><p>校验原理：<strong>将得到的CRC码用约定的G(X)去除，余数为0，结果正确 ，某一位出错，则余数不为0</strong></p>
<p>纠错的话，与G(X)的选择有关系，这方面比较深，<strong>考研大纲不考察纠错这块的知识点</strong></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/blog/2019/11/25/%E6%B1%89%E6%98%8E%E7%A0%81%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90(%E6%B8%85%E6%99%B0%E5%AE%9E%E4%BE%8B%E8%AE%B2%E8%A7%A3)/">汉明码原理解析(清晰实例讲解)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/blog/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/blog/tags/%E6%B1%89%E6%98%8E%E7%A0%81-%E6%A0%A1%E9%AA%8C%E7%A0%81-%E6%B1%89%E6%98%8E%E6%A0%A1%E9%AA%8C%E7%A0%81/">汉明码 校验码 汉明校验码</a></span><div class="content"><a id="more"></a>

<h4 id="1-汉明码实质及原理"><a href="#1-汉明码实质及原理" class="headerlink" title="1.汉明码实质及原理"></a>1.汉明码实质及原理</h4><p>汉明码实质上是<strong>多重奇偶校验</strong>，其实现原理是：在有效信息位中加入几个校验位形成汉明码，使码距比较均匀的拉大。<strong>具有检验并纠正一位错误的能力</strong>。</p>
<br>

<h4 id="2-核心公式介绍"><a href="#2-核心公式介绍" class="headerlink" title="2.核心公式介绍"></a>2.核心公式介绍</h4><p><strong>2^k &gt;= N+K+1</strong></p>
<p>其中，<code>K</code>代表<strong>校验位的位数</strong>，<code>N</code>代表<strong>信息位的位数</strong></p>
<p>下面是 <strong>信息位N值与校验位K值的对应关系表</strong>(重要)</p>
<table>
<thead>
<tr>
<th>信息码位数(N)</th>
<th>1</th>
<th>2~4</th>
<th>5~11</th>
<th>12~26</th>
<th>27~57</th>
<th align="center">58~120</th>
</tr>
</thead>
<tbody><tr>
<td>校验码位数(M)</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td align="center">7</td>
</tr>
</tbody></table>
<br>

<h4 id="3-确定校验位的位置"><a href="#3-确定校验位的位置" class="headerlink" title="3.确定校验位的位置"></a>3.确定校验位的位置</h4><p>根据上表确定校验码位数之后，将它插入到信息码中(这里信息码用D表示，校验码用P表示)，规则是：</p>
<ul>
<li><strong>校验码Pi 必须是在2的i-1次方位置，即只能放在H1，H2，H4，H8…</strong></li>
<li><strong>这里指的位置都是从右向左排序（信息码和校验码都一样）</strong></li>
</ul>
<p>举个例子，现有一个<code>4位信息码(D1,D2,D3,D4)</code>，它的排列是这样的：</p>
<p>D4 D3 D2  <strong>P3</strong>  D1 <strong>P2</strong>  <strong>P1</strong> </p>
<p>知道位置之后，下一步就是确定校验位的值了</p>
<br>

<h4 id="4-确定校验位的值-核心）"><a href="#4-确定校验位的值-核心）" class="headerlink" title="4.确定校验位的值(核心）"></a>4.确定校验位的值(核心）</h4><p>我之前是卡在这一步了，我觉得大部分博客没有直观的将这部分相关的知识讲到位，都是含糊其辞，其实用对方法后，是很简单的，下面是确定校验位值的思路：</p>
<ul>
<li><strong>根据校验位的位数，确定每个位置占用的校验位号</strong></li>
<li><strong>根据参与校验的信息位的位置，确定信息位的值(异或计算)</strong></li>
</ul>
<br>

<p>下面通过一个例子介绍，现在有一个二进制编码1011(D1,D2,D3,D4)，求它的汉明码</p>
<ul>
<li><p><strong>首先确定校验位的位数及位置</strong></p>
<p>信息码共<code>4</code>位，校验码通过公式计算为<code>3</code>位，一共<code>7</code>位，排列如下</p>
<p>D4 D3 D2  <strong>P3</strong>  D1 <strong>P2</strong>  <strong>P1</strong></p>
<p><strong>它的校验位的对应表如下：</strong></p>
</li>
</ul>
<table>
<thead>
<tr>
<th>位置(从右至左)</th>
<th>占用的校验位号</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td align="center">1=1</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td align="center">2=2</td>
</tr>
<tr>
<td>3</td>
<td>1，2</td>
<td align="center">3=1+2</td>
</tr>
<tr>
<td>4</td>
<td>4</td>
<td align="center">4=4</td>
</tr>
<tr>
<td>5</td>
<td>1，4</td>
<td align="center">5=1+4</td>
</tr>
<tr>
<td>6</td>
<td>2，4</td>
<td align="center">6=2+4</td>
</tr>
<tr>
<td>7</td>
<td>1，2，4</td>
<td align="center">7=1+2+4</td>
</tr>
</tbody></table>
<br>

<ul>
<li><p><strong>确定校验位的值(敲黑板)</strong></p>
<p>确定各校验码 的参与校验位的信息位的位置，如下表</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>校验码名称(位置)</th>
<th>参与校验码的信息位的位置</th>
</tr>
</thead>
<tbody><tr>
<td>P1 (位置为1)</td>
<td>1，3，5，7      <strong>(1出现过的位置)</strong></td>
</tr>
<tr>
<td>P2 (位置为2)</td>
<td>2，3，6，7      <strong>(2出现过的位置)</strong></td>
</tr>
<tr>
<td>P3 (位置为4)</td>
<td>4，5，6，7      <strong>(4出现过的位置)</strong></td>
</tr>
</tbody></table>
<p>​    <strong>现在就可以根据上表确定各校验位的值了(异或运算)：</strong></p>
<p>​    P1 = D1⊕D2⊕D4 = 1⊕0⊕1 = 0</p>
<p>​    P2 = D1⊕D3⊕D4 = 1⊕1⊕1 =1</p>
<p>​    P3 = D2⊕D3⊕D4 = 1⊕0⊕1 = 0</p>
<p>​    <strong>异或运算简单来说，就是两个相同的数结果为0，不同的数结果为1，这里看1的个数就成，偶数为0，奇数就是1</strong><br><br></p>
<p>所以生成的海明码为</p>
<p>D4 D3 D2  <strong>P3</strong>  D1 <strong>P2</strong>  <strong>P1</strong></p>
<p>1    1   0     <strong>0</strong>     1    <strong>1</strong>    <strong>0</strong></p>
<br>

<h4 id="5-汉明码纠正"><a href="#5-汉明码纠正" class="headerlink" title="5.汉明码纠正"></a>5.汉明码纠正</h4><p>假设传输中H6(D3)发生了错误，原码就变为：</p>
<p>1    <u>0</u>   0     <strong>0</strong>     1    <strong>1</strong>    <strong>0</strong></p>
<p>检错过程很简单，<strong>将接收到的码字重新进行奇偶校验</strong> ：</p>
<p>S1 = P1⊕D1⊕D2⊕D4 = 0⊕1⊕0⊕1 = 0</p>
<p>S2 = P2⊕D1⊕D3⊕D4 = 1⊕1⊕0⊕1 = 1</p>
<p>S3 = P3⊕D2⊕D3⊕D4 = 0⊕0⊕0⊕1 = 1</p>
<p>所以真值为<code>S3,S2,S1</code>，即110，转换为十进制为6，即第六位发生了错误，纠正</p>
<p>1    <u>1</u>   0     <strong>0</strong>     1    <strong>1</strong>    <strong>0</strong></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/blog/2019/11/21/Spring%20Boot%E5%8D%87%E7%BA%A7%E5%88%B02.2.x%E6%95%B0%E6%8D%AE%E8%BF%9E%E6%8E%A5%E6%8A%A5%E9%94%99%E5%8F%8A%E5%88%86%E6%9E%90/">Spring Boot升级到2.2.x数据连接报错及分析</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93-spring-boot/">数据库 spring boot</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/blog/tags/spring-boot%E5%8D%87%E7%BA%A7-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%8A%A5%E9%94%99/">spring boot升级 数据库连接报错</a></span><div class="content"><a id="more"></a>



<h4 id="1-问题"><a href="#1-问题" class="headerlink" title="1.问题"></a>1.问题</h4><p>最近需要升级下项目，我之前版本是<code>1.5.6</code>，升级到最新的<code>2.2.x</code>时，发现会报以下错误：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-21</span> <span class="number">20</span>:<span class="number">36</span>:<span class="number">42.998</span>  WARN <span class="number">224</span> --- [  restartedMain] com.zaxxer.hikari.util.DriverDataSource  : Registered driver <span class="keyword">with</span> driverClassName=com.mysql.jdbc.Driver was not found, trying direct instantiation.</span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-21</span> <span class="number">20</span>:<span class="number">36</span>:<span class="number">47.104</span> ERROR <span class="number">224</span> --- [  restartedMain] com.zaxxer.hikari.pool.HikariPool        : HikariPool<span class="number">-1</span> - Exception during pool initialization.</span><br><span class="line">java.sql.SQLNonTransientConnectionException: Could not create connection to database server. Attempted reconnect <span class="number">3</span> times. Giving up.</span><br></pre></td></tr></table></figure>

<br>

<h4 id="2-问题分析"><a href="#2-问题分析" class="headerlink" title="2.问题分析"></a>2.问题分析</h4><p>问题很显然是<strong>数据库驱动找不到了</strong>，经过查阅资料，这是Spring Boot的更新日志：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Upgrade to Commons Pool2 2.6.1 #15946</span><br><span class="line">Upgrade to Lettuce 5.1.4.RELEASE #15945</span><br><span class="line">Upgrade to Lombok 1.18.6 #15928</span><br><span class="line">Upgrade to Pooled Jms Version 1.0.4 #15927</span><br><span class="line">Upgrade to Liquibase 3.6.3 #15926</span><br><span class="line">Upgrade to Mimepull 1.9.11 #15925</span><br><span class="line">Upgrade to Infinispan 9.4.6.Final #15924</span><br><span class="line">Upgrade to Groovy 2.5.6 #15923</span><br><span class="line">Upgrade to Tomcat 9.0.16 #15922</span><br><span class="line">Upgrade to Log4j2 2.11.2 #15921</span><br><span class="line">Upgrade to Artemis 2.6.4 #15920</span><br><span class="line">Upgrade to Byte Buddy 1.9.10 #15919</span><br><span class="line">Upgrade to Mysql 8.0.15 #15918</span><br></pre></td></tr></table></figure>

<p>日志中将<code>Mysql</code>更新到了8.0.15，新版中的Mysql引擎进行了升级，所以需要改动一下配置文件，主要是修改以下几个地方</p>
<ul>
<li><code>spring.datasource.driver-class-name</code></li>
<li><code>spring.datasource.url</code></li>
</ul>
<br>

<h4 id="3-解决方案"><a href="#3-解决方案" class="headerlink" title="3.解决方案"></a>3.解决方案</h4><p>将<code>spring.datasource.driver-class-name</code>属性替换为<code>com.mysql.cj.jdbc.Driver</code></p>
<p>将<code>spring.datasource.url</code>属性值替换为<code>jdbc:mysql://localhost:3306/finger?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;rewriteBatchedStatements=true</code></p>
<p>注意这里加了个对于时区的设置，默认是<code>UTC</code>，但是与我们国家的时差相差8个小时，这里我将它设置为<code>Asia/Shanghai</code>,也可设置成<code>Asia/HongKong</code></p>
<p>下面我贴下新版本的完整配置参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url=jdbc:mysql:<span class="comment">//localhost:3306/finger?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;rewriteBatchedStatements=true</span></span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=<span class="number">123456</span></span><br><span class="line">spring.datasource.driver-<span class="class"><span class="keyword">class</span>-<span class="title">name</span></span>=com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.datasource.type=com.zaxxer.hikari.HikariDataSource</span><br><span class="line">spring.datasource.hikari.maximum-pool-size=<span class="number">100</span></span><br><span class="line">spring.datasource.hikari.max-lifetime=<span class="number">27000000</span></span><br><span class="line">spring.datasource.hikari.minimum-idle=<span class="number">20</span></span><br></pre></td></tr></table></figure>

<br>

<h4 id="4-总结"><a href="#4-总结" class="headerlink" title="4.总结"></a>4.总结</h4><p>主要问题在于新版本的<strong>数据库引擎进行了升级</strong>，所以需要对新版本的数据库引擎进行适配，下面是官方的更新<a href="https://github.com/spring-projects/spring-boot/releases/tag/v2.1.3.RELEASE" target="_blank" rel="noopener">日志地址</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/blog/2019/11/17/%E6%9C%8B%E5%8F%8B%E5%9C%88%E6%8A%95%E7%A5%A8%E6%B4%BB%E5%8A%A8-%E5%88%B7%E7%A5%A8%E6%A1%88%E4%BE%8B%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%88%86%E6%9E%90/">朋友圈投票活动-刷票案例实现与分析</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-17</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/blog/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span><div class="content"><a id="more"></a>

<h4 id="1-声明"><a href="#1-声明" class="headerlink" title="1.声明"></a>1.声明</h4><p>本文只讨论技术范畴内的刷票行为。</p>
<br>

<h4 id="2-案例描述"><a href="#2-案例描述" class="headerlink" title="2.案例描述"></a>2.案例描述</h4><p>某商城（以下简称A商城）在微信平台上举办了一场在线投票活动，微信用户可通过活动链接访问到投票页面，对喜欢的作品进行投票；每个微信帐号每天只能给单个作品投1张选票</p>
<br>

<h4 id="3-漏洞分析"><a href="#3-漏洞分析" class="headerlink" title="3.漏洞分析"></a>3.漏洞分析</h4><p>表面上看，A商城已经对投票活动进行了反作弊处理，因为限制了每个微信用户每天只能投一张票。如果用户都是正常地通过微信访问这个投票服务进行投票的话，的确是能起到预期效果的。</p>
<p>然而，如果查看投票页面的原始地址，即按住页面向下拖动，会发现屏幕顶端显示为”本网页由<code>XXX</code>提供”（这里的<code>&quot;XXX&quot;</code>并不是<code>&quot;mp.weixin.qq.com&quot;</code>），而是A商城的域名。也就是说，这个投票活动的程序是运行在A商城的服务器上面的。</p>
<p>基于以上分析，可以推断出用户投票操作的网络拓扑结构示意图应该是这样的：<br><img src="https://img-blog.csdnimg.cn/20191117214608307.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>微信用户访问投票页面时，微信服务器只是进行了请求转发，具体的投票计数与校验都是在A商城的服务器上的。</p>
<p>那么，商城是怎么来区分投票用户的呢？</p>
<p>这里就涉及到微信公众平台<code>OpenID</code>的概念了。官方对<code>OpenID</code>的解释是：加密后的微信号，每个用户对每个公众号的OpenID是唯一的。要验证这一点也很容易，只需要通过采用多个微信账号进行投票，并对投票过程进行<strong>网络抓包</strong>（这一步是最关键的点，我用Charles进行的抓包，这里是关于<a href="https://blog.csdn.net/huoji555/article/details/103098969" target="_blank" rel="noopener">Charles抓包的教程</a>），这里主要是为了获取第三方的请求参数</p>
<p>基于这一点，微信公众平台在转发投票请求时，会在POST参数中包含用户的<code>OpenID</code>；A商城在接收到投票的POST请求后，通过查询当前<code>OpenID</code>是否在当天已经投过票，就可以阻止单一用户重复投票的行为了。</p>
<p>然而，这里面却存在一个很大的漏洞，<strong>A商城只能判断<code>OpenID</code>是否出现了重复，但是却无法校验<code>OpenID</code>的有效性，因为它是无法调用微信服务器来对这个<code>OpenID</code>进行校验的。</strong></p>
<br>

<h4 id="4-实现思路"><a href="#4-实现思路" class="headerlink" title="4.实现思路"></a><strong>4.实现思路</strong></h4><ul>
<li>抓包获取到请求参数，模拟Https请求</li>
<li>生成随机位数的<code>Openid</code></li>
<li>为防止服务器拦截请求，随机时间后向服务器发送请求</li>
<li>动态模拟不同的设备，即修改<code>User-Agent</code>，否则，服务端可以较为容易地识别作弊行为</li>
</ul>
<br>

<h4 id="5-作弊与反作弊"><a href="#5-作弊与反作弊" class="headerlink" title="5.作弊与反作弊"></a>5.作弊与反作弊</h4><p>看到这里，也许有的同学心中窃喜，以后投票都可以采用这种方式“刷票”了么？</p>
<p>很遗憾，当然不是。其实本文中案例的漏洞是很低级的，只是，当前的确还存在不少比例的投票活动是采用这种模式。</p>
<p>要判断一个投票活动是否可以采用这种方式来作弊也很简单。采用本文中的方法，若查看到活动的网址是非微信官方的，而且整个投票过程也没有额外的校验，那么实现作弊的可能性就很大了；再通过抓包看下通讯交互过程，并用网络请求工具修改参数后重新请求下，即可验证是否真的可以作弊了。</p>
<p>不过，活动举办方可以通过一些手段，大大提高作弊的门槛：</p>
<ul>
<li>要求投票用户先关注活动举办方的公众号，然后调用微信官方的投票功能；</li>
<li>要求投票用户在投票活动举办方的网站上进行注册（手机号验证、实名验证）</li>
</ul>
<p>不管采用这两种方式中的哪一种，本文中的“刷票”方法就完全失效了</p>
<br>

<h4 id="6-代码实现"><a href="#6-代码实现" class="headerlink" title="6.代码实现"></a>6.代码实现</h4><p>本案例只提供实现的流程，不提供刷票的网站及参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @auther: Ragty</span></span><br><span class="line"><span class="comment"> * @describe: Get请求远程接口</span></span><br><span class="line"><span class="comment"> * @param: [url, parameters]</span></span><br><span class="line"><span class="comment"> * @return: java.lang.String</span></span><br><span class="line"><span class="comment"> * @date: 2019/1/16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sendGet</span><span class="params">(String url, Map&lt;String, String&gt; parameters)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String result=<span class="string">""</span>;</span><br><span class="line">    BufferedReader in = <span class="keyword">null</span>;<span class="comment">// 读取响应输入流</span></span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();<span class="comment">// 存储参数</span></span><br><span class="line">    String params = <span class="string">""</span>;<span class="comment">// 编码之后的参数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 编码请求参数</span></span><br><span class="line">        <span class="keyword">if</span>(parameters.size()==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(String name:parameters.keySet())&#123;</span><br><span class="line">                sb.append(name).append(<span class="string">"="</span>).append(java.net.URLEncoder.encode(parameters.get(name), <span class="string">"UTF-8"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            params=sb.toString();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (String name : parameters.keySet()) &#123;</span><br><span class="line">                sb.append(name).append(<span class="string">"="</span>).append(java.net.URLEncoder.encode(parameters.get(name), <span class="string">"UTF-8"</span>)).append(<span class="string">"&amp;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            String temp_params = sb.toString();</span><br><span class="line">            params = temp_params.substring(<span class="number">0</span>, temp_params.length() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String full_url = url + <span class="string">"?"</span> + params;</span><br><span class="line">        System.out.println(<span class="string">"请求链接为:"</span>+full_url);</span><br><span class="line">        <span class="comment">// 创建URL对象</span></span><br><span class="line">        URL connURL = <span class="keyword">new</span> URL(full_url);</span><br><span class="line">        <span class="comment">// 打开URL连接</span></span><br><span class="line">        HttpURLConnection httpConn = (HttpURLConnection) connURL.openConnection();</span><br><span class="line">        <span class="comment">// 设置通用属性</span></span><br><span class="line">        httpConn.setRequestProperty(<span class="string">"Accept"</span>, <span class="string">"*/*"</span>);</span><br><span class="line">        httpConn.setRequestProperty(<span class="string">"Connection"</span>, <span class="string">"Keep-Alive"</span>);</span><br><span class="line">        httpConn.setRequestProperty(<span class="string">"User-Agent"</span>, <span class="string">"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)"</span>);</span><br><span class="line">        <span class="comment">// 建立实际的连接</span></span><br><span class="line">        httpConn.connect();</span><br><span class="line">        <span class="comment">// 响应头部获取</span></span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; headers = httpConn.getHeaderFields();</span><br><span class="line">        <span class="comment">// 遍历所有的响应头字段</span></span><br><span class="line">        <span class="keyword">for</span> (String key : headers.keySet()) &#123;</span><br><span class="line">            System.out.println(key + <span class="string">"\t：\t"</span> + headers.get(key));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 定义BufferedReader输入流来读取URL的响应,并设置编码方式</span></span><br><span class="line">        in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(httpConn.getInputStream(), <span class="string">"UTF-8"</span>));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="comment">// 读取返回的内容</span></span><br><span class="line">        <span class="keyword">while</span> ((line = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            result += line;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (in != <span class="keyword">null</span>) &#123; in.close(); &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @auther: Ragty</span></span><br><span class="line"><span class="comment"> * @describe: Post请求远程接口</span></span><br><span class="line"><span class="comment"> * @param: [url, parameters]</span></span><br><span class="line"><span class="comment"> * @return: java.lang.String</span></span><br><span class="line"><span class="comment"> * @date: 2019/1/16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sendPost</span><span class="params">(String url, Map&lt;String, String&gt; parameters)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String result = <span class="string">""</span>;<span class="comment">// 返回的结果</span></span><br><span class="line">    BufferedReader in = <span class="keyword">null</span>;<span class="comment">// 读取响应输入流</span></span><br><span class="line">    PrintWriter out = <span class="keyword">null</span>;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();<span class="comment">// 处理请求参数</span></span><br><span class="line">    String params = <span class="string">""</span>;<span class="comment">// 编码之后的参数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 编码请求参数</span></span><br><span class="line">        <span class="keyword">if</span> (parameters.size() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String name : parameters.keySet()) &#123;</span><br><span class="line">                sb.append(name).append(<span class="string">"="</span>).append(java.net.URLEncoder.encode(parameters.get(name), <span class="string">"UTF-8"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            params = sb.toString();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (String name : parameters.keySet()) &#123;</span><br><span class="line">                sb.append(name).append(<span class="string">"="</span>).append(java.net.URLEncoder.encode(parameters.get(name), <span class="string">"UTF-8"</span>)).append(<span class="string">"&amp;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            String temp_params = sb.toString();</span><br><span class="line">            params = temp_params.substring(<span class="number">0</span>, temp_params.length() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建URL对象</span></span><br><span class="line">        URL connURL = <span class="keyword">new</span> URL(url);</span><br><span class="line">        <span class="comment">// 打开URL连接</span></span><br><span class="line">        HttpURLConnection httpConn = (HttpURLConnection) connURL.openConnection();</span><br><span class="line">        <span class="comment">// 设置通用属性</span></span><br><span class="line">        httpConn.setRequestProperty(<span class="string">"Accept"</span>, <span class="string">"*/*"</span>);</span><br><span class="line">        httpConn.setRequestProperty(<span class="string">"Connection"</span>, <span class="string">"Keep-Alive"</span>);</span><br><span class="line">        httpConn.setRequestProperty(<span class="string">"User-Agent"</span>, <span class="string">"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)"</span>);</span><br><span class="line">        <span class="comment">// 设置POST方式</span></span><br><span class="line">        httpConn.setDoInput(<span class="keyword">true</span>);</span><br><span class="line">        httpConn.setDoOutput(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 获取HttpURLConnection对象对应的输出流</span></span><br><span class="line">        out = <span class="keyword">new</span> PrintWriter(httpConn.getOutputStream());</span><br><span class="line">        <span class="comment">// 发送请求参数</span></span><br><span class="line">        out.write(params);</span><br><span class="line">        <span class="comment">// flush输出流的缓冲</span></span><br><span class="line">        out.flush();</span><br><span class="line">        <span class="comment">// 定义BufferedReader输入流来读取URL的响应，设置编码方式</span></span><br><span class="line">        in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(httpConn.getInputStream(), <span class="string">"UTF-8"</span>));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="comment">// 读取返回的内容</span></span><br><span class="line">        <span class="keyword">while</span> ((line = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            result += line;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123; out.close(); &#125;</span><br><span class="line">            <span class="keyword">if</span> (in != <span class="keyword">null</span>) &#123; in.close(); &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span> Ragty</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span> 生成OpenId</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Date</span>   2019/11/14 18:17</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Exception</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">createOpenId</span><span class="params">(<span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    String val = <span class="string">""</span>;</span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        String charOrNum = random.nextInt(<span class="number">2</span>) % <span class="number">2</span> == <span class="number">0</span> ? <span class="string">"char"</span> : <span class="string">"num"</span>; <span class="comment">// 输出字母还是数字</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"char"</span>.equalsIgnoreCase(charOrNum)) <span class="comment">// 字符串</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> choice = random.nextInt(<span class="number">2</span>) % <span class="number">2</span> == <span class="number">0</span> ? <span class="number">65</span> : <span class="number">97</span>; <span class="comment">// 取得大写字母还是小写字母</span></span><br><span class="line">            val += (<span class="keyword">char</span>) (choice + random.nextInt(<span class="number">26</span>));</span><br><span class="line">            val += (<span class="keyword">char</span>) (choice + random.nextInt(<span class="number">26</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"num"</span>.equalsIgnoreCase(charOrNum)) <span class="comment">// 数字</span></span><br><span class="line">        &#123;</span><br><span class="line">            val += String.valueOf(random.nextInt(<span class="number">10</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span> Ragty</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>  进行一次投票</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Date</span>   2019/11/14 18:24</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Exception</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">voteOnce</span><span class="params">(String voteid, String voteUrl)</span> </span>&#123;</span><br><span class="line">    Map&lt;String,String&gt; request = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">    String openId = createOpenId(<span class="number">22</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里放请求参数</span></span><br><span class="line">    request.put(<span class="string">"name"</span>,<span class="string">"ragty"</span>);</span><br><span class="line">    request.put(<span class="string">"openid"</span>,openId);</span><br><span class="line">    String result = sendPost(voteUrl,request);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span> Ragty</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>  莫得感情的投票机器(这里加个随机模拟)</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Date</span>   2019/11/14 18:26</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Exception</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">voteMachine</span><span class="params">(String voteId, <span class="keyword">int</span> voteNumber, String voteUrl)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line"></span><br><span class="line">    Random random =  <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=voteNumber; i++) &#123;</span><br><span class="line">        voteOnce(voteId,voteUrl);</span><br><span class="line">        System.out.println(<span class="string">"进行第"</span>+i+<span class="string">"次投票,投票成功 "</span>);</span><br><span class="line">        <span class="keyword">int</span> randomTime = random.nextInt(<span class="number">5000</span>);</span><br><span class="line">        System.out.println(<span class="string">"下次投票时间间隔为:"</span>+randomTime/<span class="number">1000</span>);</span><br><span class="line">        Thread.sleep(randomTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"投票结束，本次共投"</span>+voteNumber+<span class="string">"票"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">   voteMachine(<span class="string">"11"</span>,<span class="number">10</span>,<span class="string">"https://www.baidu.com"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/blog/2019/11/16/%E4%BD%BF%E7%94%A8Charles%E5%AF%B9%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87%E6%8A%93%E5%8C%85/">使用Charles对移动设备抓包</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/blog/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/blog/tags/Charles-%E6%8A%93%E5%8C%85-%E6%89%8B%E6%9C%BA%E6%8A%93%E5%8C%85-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">Charles 抓包 手机抓包 计算机网络</a></span><div class="content"><a id="more"></a>

<h4 id="1-Charles简介"><a href="#1-Charles简介" class="headerlink" title="1.Charles简介"></a>1.Charles简介</h4><p><code>Charles</code>是一款代理服务器，通过成为电脑或者浏览器的代理，然后截取请求和请求结果达到分析抓包的目的。该软件是用Java写的，能够在Windows，Mac，Linux上使用，<strong>安装Charles的时候要先装好Java环境</strong>。这里是破解版的<a href="https://pan.baidu.com/s/1Ii9bn8FBHE1Ho6aCDH_5zg" target="_blank" rel="noopener">下载链接</a>，提取码是：<strong>fjoo</strong><br><br><br></p>
<h4 id="2-Charles主要功能"><a href="#2-Charles主要功能" class="headerlink" title="2.Charles主要功能"></a>2.Charles主要功能</h4><ul>
<li>支持SSL代理。可以截取分析SSL的请求。</li>
<li>支持流量控制。可以模拟慢速网络以及等待时间（latency）较长的请求</li>
<li>支持AJAX调试。可以自动将json或xml数据格式化，方便查看</li>
<li>支持AMF调试。可以将Flash Remoting 或 Flex Remoting信息格式化，方便查看</li>
<li>支持重发网络请求，方便后端调试</li>
<li>支持修改网络请求参数</li>
<li>支持网络请求的截获并动态修改</li>
<li>检查HTML，CSS和RSS内容是否符合W3C标准<br>


</li>
</ul>
<h4 id="3-Charles使用"><a href="#3-Charles使用" class="headerlink" title="3.Charles使用"></a>3.Charles使用</h4><ul>
<li><strong>证书安装</strong><img src="https://img-blog.csdnimg.cn/20191116152917101.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>抓电脑的包选择 <code>install Charles Root Certificate</code><br>抓移动端的包选择<code>install Charles Root Certificate on mobile Device or Remote Browser</code></li>
</ul>
<p><strong>这里记得安装证书时，需要将证书添加到受信任的证书列表</strong><br><br></p>
<ul>
<li><strong>设置Https抓包</strong><br>默认没开启https抓包，需要设置 SSL 代理：通过主菜单打开 <strong>Proxy | SSL Proxy Settings</strong> 弹窗，勾选 <code>Enable SSL proxying</code>，点击<code>Add</code>按钮，可以过滤出允许https访问的网址，如果没有特殊需求，可将这里设置为*，意为全部匹配<br><img src="https://img-blog.csdnimg.cn/2019111615304067.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>


</li>
</ul>
<ul>
<li><strong>浏览器的选择(划重点)</strong><br>需要注意的是，<code>Chrome</code>和 <code>Firefox</code>浏览器默认并不使用系统的代理服务器设置，而 Charles是通过将自己设置成代理服务器来完成封包截取的，所以在默认情况下无法截取 <code>Chrome</code> 和 <code>Firefox</code>浏览器的网络通讯内容。如果你需要截取的话，在 Chrome 中设置成使用系统的代理服务器设置即可，或者直接将代理服务器设置成<code>127.0.0.1:8888</code> 也可达到相同效果。<br>


</li>
</ul>
<ul>
<li><strong>找不到<code>request</code>和<code>response</code></strong><br>新版本的Charles默认没打开<code>request</code>和<code>response</code>，打开Edit-&gt;prefrence，选择Viewers，将默认的<code>Combine request and response</code>勾去掉即可<img src="https://img-blog.csdnimg.cn/201911161531376.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>


</li>
</ul>
<h4 id="4-对PC端抓包"><a href="#4-对PC端抓包" class="headerlink" title="4.对PC端抓包"></a>4.对PC端抓包</h4><p>现在的配置就可以对PC端进行抓包了，我这里在浏览器中访问百度，搜索关键词<code>123456</code>,得到以下结果，可以在<code>Request</code>中找到我的搜索项<br><img src="https://img-blog.csdnimg.cn/20191116153250321.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>抓取到的响应数据</strong><br><img src="https://img-blog.csdnimg.cn/2019111615333233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<br>

<h4 id="4-在移动端抓包"><a href="#4-在移动端抓包" class="headerlink" title="4.在移动端抓包"></a>4.在移动端抓包</h4><ul>
<li><p><strong>在移动端和PC端安装证书</strong></p>
<p>PC端安装证书在前边讲过了，不予赘述</p>
<p>移动端安装证书需要访问移动端浏览器，在网址输入栏键入<code>chls.pro/ssl</code>，下载好证书后，需要安装证书，我这里用的是ipad，需要在设置-&gt;通用-&gt;描述文件-&gt;选择证书，信任，然后还有亿点小插曲</p>
<p>我的设备是ios10.3，按照上述证书信任后，还不能正确抓包，因为这个还没有正确信任，它提示你<code>Client SSL handshake failed: An unknown issue occurrenotepadd processing the certificate (certificate_unknown)</code></p>
<p><strong>解决方案</strong>：设置-&gt;通用-&gt;关于本机-&gt;证书信任设置-&gt; 找到charles proxy CA然后信任该证书即可.<br><img src="https://img-blog.csdnimg.cn/20191116153417585.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ul>
<br>

<ul>
<li><p><strong>配置代理</strong></p>
<p>确认当前移动设备与安装charles的电脑在同一局域网下，选择<strong>配置代理</strong>一项，选择手动</p>
<p><strong>配置IP地址</strong>：在服务器一栏键入安装Charles电脑的IP地址(可通过cmd的ipconfig查看或者通过Charles的Help一栏查看)</p>
<p><strong>配置端口</strong>：在Charles中寻找Proxy-&gt;proxy Settings查看端口，默认为8888</p>
<p><strong>然后你的PC端会发送一个请求，允许代理</strong> </p>
</li>
</ul>
<br>

<ul>
<li><p><strong>代理后移动端无网络的解决方案</strong></p>
<p>需要将系统的防火墙关闭，即可正常访问网络</p>
<p><strong>最后抓完包记得将代理关闭(敲黑板)</strong></p>
</li>
</ul>
<br>

<ul>
<li><p><strong>试着抓个包</strong></p>
<p>打开<code>Bilibili</code>，搜索一下我女朋友的名字<code>新垣结衣</code>，出现以下界面<br><img src="https://img-blog.csdnimg.cn/20191116153642956.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>然后我们看一下Charles中我的请求<code>keyword：新垣结衣</code><br><img src="https://img-blog.csdnimg.cn/20191116153738608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>然后是抓取到的关于我老婆的一点信息：<img src="https://img-blog.csdnimg.cn/20191116154019813.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ul>
<h4 id="5-总结一下"><a href="#5-总结一下" class="headerlink" title="5.总结一下"></a>5.总结一下</h4><p>其实，抓包什么的不太重要，我只是来秀我老婆的</p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/9/">9</a><a class="extend next" rel="next" href="/blog/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://blog-1251750343.cos.ap-beijing.myqcloud.com/blog/blog-bg.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2020 By Ragty</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text"><a href="http://beian.miit.gov.cn " target="_blank" rel="noopener" charset="utf-8"> ICP备案号:京ICP备<13502>号 </a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/blog/js/utils.js?version=1.7.0"></script><script src="/blog/js/fancybox.js?version=1.7.0"></script><script src="/blog/js/sidebar.js?version=1.7.0"></script><script src="/blog/js/copy.js?version=1.7.0"></script><script src="/blog/js/fireworks.js?version=1.7.0"></script><script src="/blog/js/transition.js?version=1.7.0"></script><script src="/blog/js/scroll.js?version=1.7.0"></script><script src="/blog/js/head.js?version=1.7.0"></script><script src="/blog/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>