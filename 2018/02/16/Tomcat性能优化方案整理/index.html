<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Tomcat性能优化方案整理"><meta name="keywords" content="服务器优化 tomcat性能优化 服务器性能优化"><meta name="author" content="Ragty"><meta name="copyright" content="Ragty"><title>Tomcat性能优化方案整理 | Ragty の Blog</title><link rel="shortcut icon" href="/blog/melody-favicon.ico"><link rel="stylesheet" href="/blog/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-text">Tomcat性能优化方案整理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#"><span class="toc-text">tomcat内存优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#"><span class="toc-text">tomcat 线程优化</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://secure.gravatar.com/avatar/dcc38a5a0d37cb7348d4f72d8f6a2de0"></div><div class="author-info__name text-center">Ragty</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/huoji555" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/blog/archives"><span class="pull-left">文章</span><span class="pull-right">83</span></a><a class="author-info-articles__tags article-meta" href="/blog/tags"><span class="pull-left">标签</span><span class="pull-right">75</span></a><a class="author-info-articles__categories article-meta" href="/blog/categories"><span class="pull-left">分类</span><span class="pull-right">38</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接-Links</div><a class="author-info-links__name text-center" href="https://blog.csdn.net/huoji555" target="_blank" rel="noopener">MY-CSDN</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://blog-1251750343.cos.ap-beijing.myqcloud.com/blog/blog-bg.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/blog/">Ragty の Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/blog">Home</a><a class="site-page" href="/blog/archives">Archives</a><a class="site-page" href="/blog/categories">Categories</a><a class="site-page" href="/blog/tags">Tags</a><a class="site-page" href="/blog/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Tomcat性能优化方案整理</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-02-16</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/blog/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">2.2k</span><span class="post-meta__separator">|</span><span>阅读时长: 7 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><a id="more"></a>

<h1><strong><span style="color:#000000;">Tomcat<span style="font-family:'宋体';">性能优化方案整理</span></span></strong></h1><p><span style="font-family:'宋体';">考虑一下这种场景，你开发了一个应用，它有十分优</span> <span style="font-family:'宋体';">秀的布局设计，最新的特性以及其它的优秀特点。但是在性能这方面欠缺，不管这个应用如何都会遭到客户拒绝。客户总是期望它们的应用应该有更好的性能。如果</span> <span style="font-family:'宋体';">你在产品中使用了</span>Tomcat<span style="font-family:'宋体';">服务器，那么这篇文章就会给你几方面来提升</span><span style="font-family:Calibri;">Tomcat</span><span style="font-family:'宋体';">服务器的性能</span><span style="font-family:'宋体';">经过沉思我已经知道了和早期版本相比最新的</span>Tomcat<span style="font-family:'宋体';">提供更好的性能和稳定性。所以一直使用最新的</span><span style="font-family:Calibri;">Tomcat</span><span style="font-family:'宋体';">版本。现在本文使用下面几步来提高</span><span style="font-family:Calibri;">Tomcat</span><span style="font-family:'宋体';">服务器的性能。</span></p><p>1. <span style="font-family:'宋体';">增加</span>JVM<span style="font-family:'宋体';">堆内存大小</span> </p><p>2. <span style="font-family:'宋体';">修复</span>JRE<span style="font-family:'宋体';">内存泄漏</span> </p><p>3. <span style="font-family:'宋体';">线程池设置</span> </p><p>4. <span style="font-family:'宋体';">压缩</span> </p><p>5. <span style="font-family:'宋体';">数据库性能调优</span> </p><p>6. Tomcat<span style="font-family:'宋体';">本地库 </span></p><p>7. <span style="font-family:'宋体';">其它选项</span> </p><p><strong><span style="font-family:'宋体';">第一步</span>  – <span style="font-family:'宋体';">提高</span><span style="font-family:'Times New Roman';">JVM</span><span style="font-family:'宋体';">栈内存</span><span style="font-family:'Times New Roman';">Increase JVM heap memory</span></strong> </p><p><span style="font-family:'宋体';">你使用过</span>tomcat<span style="font-family:'宋体';">的话，简单的说就是</span><span style="font-family:Calibri;">“</span><span style="font-family:'宋体';">内存溢出</span><span style="font-family:Calibri;">”. </span><span style="font-family:'宋体';">通常情况下，这种问题出现在实际的生产环境中</span><span style="font-family:Calibri;">.</span><span style="font-family:'宋体';">产生这种问题的原因是</span><span style="font-family:Calibri;">tomcat</span><span style="font-family:'宋体';">使用较少 的内存给进程</span><span style="font-family:Calibri;">,</span><span style="font-family:'宋体';">通过配置</span><span style="font-family:Calibri;">TOmcat</span><span style="font-family:'宋体';">的配置文件</span><span style="font-family:Calibri;">(Windows </span><span style="font-family:'宋体';">下的</span><span style="font-family:Calibri;">catalina.bat</span><span style="font-family:'宋体';">或</span><span style="font-family:Calibri;">Linux</span><span style="font-family:'宋体';">下的</span><span style="font-family:Calibri;">catalina.sh)</span><span style="font-family:'宋体';">可以解决这种问 题</span><span style="font-family:Calibri;">.</span><span style="font-family:'宋体';">这种解决方法是通过增加</span><span style="font-family:Calibri;">JVM</span><span style="font-family:'宋体';">的栈内存实现的</span><span style="font-family:Calibri;">.</span><span style="font-family:'宋体';">也就是说，</span><span style="font-family:Calibri;">JVM</span><span style="font-family:'宋体';">通常不去调用垃圾回收器，所以服务器可以更多关注处理</span><span style="font-family:Calibri;">web</span><span style="font-family:'宋体';">请求，并要求尽快完成。要 更改文件</span><span style="font-family:Calibri;">(catalina.sh) </span><span style="font-family:'宋体';">位于</span><span style="font-family:Calibri;">"\tomcat server folder\bin\catalina.sh"</span><span style="font-family:'宋体';">，下面，给出这个文件的配置信息，</span></p><p><strong>[plain]</strong> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="view plain"><u><span style="color:rgb(0,0,255);">view plain</span></u></a> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="copy"><u><span style="color:rgb(0,0,255);">copy</span></u></a> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="print"><u><span style="color:rgb(0,0,255);">print</span></u></a><a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="?"><u><span style="color:rgb(0,0,255);">?</span></u></a></p><p>1. JAVA_OPTS="-Djava.awt.headless=true -Dfile.encoding=UTF-8  </p><p>2.     -server -Xms1024m -Xmx1024m  </p><p>3.     -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m  </p><p>4.     -XX:MaxPermSize=512m -XX:+DisableExplicitGC"  </p><p>-Xms – <span style="font-family:'宋体';">指定初始化时化的栈内存</span></p><p>-Xms – <span style="font-family:'宋体';">指定初始化时化的栈内存</span><br />-Xmx – <span style="font-family:'宋体';">指定最大栈内存</span><br /><span style="font-family:'宋体';">在重启你的</span>Tomcat<span style="font-family:'宋体';">服务器之后，这些配置的更改才会有效。下面将介绍如何处理</span><span style="font-family:Calibri;">JRE</span><strong><span style="font-family:'宋体';">内存泄漏</span></strong>.  </p><p><strong><span style="font-family:'宋体';">第二步</span> – <span style="font-family:'宋体';">解决</span><span style="font-family:'Times New Roman';">JRE</span><span style="font-family:'宋体';">内存泄露</span></strong> </p><p><span style="font-family:'宋体';">性能表现不佳的另一个主要原因是内存泄漏，正</span> <span style="font-family:'宋体';">如我之前说过：始终使用最新的</span>tomcat<span style="font-family:'宋体';">服务器以获得更好的性能和可伸缩性。现在，这句话变成真的。如果我们使用最新的</span><span style="font-family:Verdana;">tomcat</span><span style="font-family:'宋体';">版本</span><span style="font-family:Verdana;">6.0.26</span><span style="font-family:'宋体';">及 以上就可以解决这个错误，因为它包含了一个监听器来处理</span><span style="font-family:Verdana;">JRE</span><span style="font-family:'宋体';">和</span><span style="font-family:Verdana;">PermGen</span><span style="font-family:'宋体';">的内存泄漏。使用的监听器是，</span></p><p><strong>[html]</strong> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="view plain"><u><span style="color:rgb(0,0,255);">view plain</span></u></a> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="copy"><u><span style="color:rgb(0,0,255);">copy</span></u></a> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="print"><u><span style="color:rgb(0,0,255);">print</span></u></a><a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="?"><u><span style="color:rgb(0,0,255);">?</span></u></a></p><p>1. &lt;Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener" /&gt;  </p><p><span style="font-family:'宋体';">你可以在</span>server.xml<span style="font-family:'宋体';">文件中找到这个监听器的配置，</span><span style="font-family:Verdana;">server.xml</span><span style="font-family:'宋体';">位置在</span><span style="font-family:Verdana;">“tomcat project folder/conf/server.xml”</span><span style="font-family:'宋体';">。接下来，我们将看看如何调整连接属性</span><span style="font-family:Verdana;">“maxThreads”</span><span style="font-family:'宋体';">。</span></p><p><strong><span style="font-family:'宋体';">第三步</span> – <span style="font-family:'宋体';">线程池设置</span></strong> </p><p><span style="font-family:'宋体';">线程池指定</span>Web<span style="font-family:'宋体';">请求负载的数量，因此，为</span><span style="font-family:'宋体';">获得更好的性能</span><span style="font-family:'宋体';">这部分应小心处理。可以通过调整连接器属性</span>“maxThreads”<span style="font-family:'宋体';">完成设置。</span>maxThreads<span style="font-family:'宋体';">的值应该根据流量的大小，如果值过低，将有没有足够的线程来处理所有的请求，请求将进入等待状态，只有当一个的处理线程释放后才被处理；如果设置的太大，</span>Tomcat<span style="font-family:'宋体';">的启动将花费更多时间。因此它取决于我们给</span>maxThreads<span style="font-family:'宋体';">设置一个正确的值</span><span style="font-family:'宋体';">。</span></p><p><strong>[html]</strong> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="view plain"><u><span style="color:rgb(0,0,255);">view plain</span></u></a> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="copy"><u><span style="color:rgb(0,0,255);">copy</span></u></a> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="print"><u><span style="color:rgb(0,0,255);">print</span></u></a><a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="?"><u><span style="color:rgb(0,0,255);">?</span></u></a></p><p>1. &lt;Connector port="8080" address="localhost"  </p><p>2. 2   maxThreads="250" maxHttpHeaderSize="8192"  </p><p>3. 3   emptySessionPath="true" protocol="HTTP/1.1"  </p><p>4. 4   enableLookups="false" redirectPort="8181" acceptCount="100"  </p><p>5. 5   connectionTimeout="20000" disableUploadTimeout="true" /&gt;  </p><p> </p><p><span style="font-family:'宋体';">在上述配置中，</span>maxThreads<span style="font-family:'宋体';">值设定为</span><span style="font-family:Calibri;">“250”</span><span style="font-family:'宋体';">，这指定可以由服务器处理的并发请求的最大数量。如果没有指定，这个属性的默认值为</span><span style="font-family:Calibri;">“200”</span><span style="font-family:'宋体';">。任何多出的并发请求将收到</span><span style="font-family:Calibri;">“</span><span style="font-family:'宋体';">拒绝连接</span><span style="font-family:Calibri;">”</span><span style="font-family:'宋体';">的错误提示，直到另一个处理请求进程被释放。错误看起来如下，</span></p><p><strong>[java]</strong> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="view plain"><u><span style="color:rgb(0,0,255);">view plain</span></u></a> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="copy"><u><span style="color:rgb(0,0,255);">copy</span></u></a> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="print"><u><span style="color:rgb(0,0,255);">print</span></u></a><a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="?"><u><span style="color:rgb(0,0,255);">?</span></u></a></p><p>1. org.apache.tomcat.util.threads.ThreadPool logFull SEVERE: All threads (250) are  </p><p>2. currently busy, waiting. Increase maxThreads (250) or check the servlet status  </p><p><span style="font-family:'宋体';">如果应用提示上述错误，务必检查上述错误是否是由于单个请求花费太长时间造成的，这个问题的原因是这样的，有时候如果数据库连接不释放的话，进程将不会处理其它请求。</span>  </p><p><em><span style="font-family:'宋体';">注意</span>: </em><span style="font-family:'宋体';">如果请求的数量超过了</span>“750”，这将不是意味着将maxThreads属性值设置为 “750”，它意外着最好使用“Tomcat集群”的多个实例。也就是说，如果有“1000”请求，两个Tomcat实例设置“maxThreads= 500”，而不在单Tomcat实例的情况下设置maxThreads=1000。<br /><br /><span style="font-family:'宋体';">根据我的经验，准确值的设定可以通过将应用在在各种环境中测试得出。接下来，我们来看看如何压缩的</span>MIME类型。 </p><p><strong><span style="font-family:'宋体';">第</span>4<span style="font-family:'宋体';">步</span><span style="font-family:'Times New Roman';">- </span><span style="font-family:'宋体';">压缩</span></strong> </p><p>Tomcat<span style="font-family:'宋体';">有一个通过在</span><span style="font-family:Calibri;">server.xml</span><span style="font-family:'宋体';">配置文件中设置压缩的选项。压缩可以在</span><span style="font-family:Calibri;">connector</span><span style="font-family:'宋体';">像如下设置中完成， </span></p><p><strong>[html]</strong> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="view plain"><u><span style="color:rgb(0,0,255);">view plain</span></u></a> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="copy"><u><span style="color:rgb(0,0,255);">copy</span></u></a> <a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="print"><u><span style="color:rgb(0,0,255);">print</span></u></a><a href="http://blog.csdn.net/cicada688/article/details/14451541" target="_blank" rel="noopener" title="?"><u><span style="color:rgb(0,0,255);">?</span></u></a></p><p>1. 1   &lt;Connector port="8080" protocol="HTTP/1.1"  </p><p>2. 2   connectionTimeout="20000"  </p><p>3. 3   redirectPort="8181" compression="500"  </p><p>4. 4   compressableMimeType="text/html,text/xml,text/plain,application/octet-stream" /&gt;  </p><p><span style="font-family:'宋体';">在前面的配置中，当文件的大小大于等于</span>500bytes时才会压缩。如果当文件达到了大小但是却没有被压缩，那么设置属性compression="on"。否则Tomcat默认设置是“off”。接下来我们将看看如何调优数据库。  </p><p><strong><span style="font-family:'宋体';">第五步</span>- <span style="font-family:'宋体';">数据库性能调优</span></strong> </p><p>Tomcat<span style="font-family:'宋体';">性能在等待数据库查询被执行期间会降低。如今大多数应用程序都是使用可能包含</span><span style="font-family:Calibri;">“</span><span style="font-family:'宋体';">命名查询</span><span style="font-family:Calibri;">”</span><span style="font-family:'宋体';">的关系型数据库。如果是那样的 话，</span><span style="font-family:Calibri;">Tomcat</span><span style="font-family:'宋体';">会在启动时默认加载命名查询，这个可能会提升性能。另一件重要事是确保所有数据库连接正确地关闭。给数据库连接池设置正确值也是十分重要 的。我所说的值是指</span><span style="font-family:Calibri;">Resource</span><span style="font-family:'宋体';">要素的最大空闲数（</span><span style="font-family:Calibri;">maxIdle</span><span style="font-family:'宋体';">），最大连接数（</span><span style="font-family:Calibri;">maxActive</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">,</span><span style="font-family:'宋体';">最大建立连接等待时间（</span><span style="font-family:Calibri;">maxWait</span><span style="font-family:'宋体';">）属 性的值。因为配置依赖与应用要求，我也不能在本文指定正确的值。你可以通过调用数据库性能测试来找到正确的值。 </span><span style="font-family:Calibri;"> </span></p><p><strong><span style="font-family:'宋体';">第</span>6<span style="font-family:'宋体';">步 </span><span style="font-family:'Times New Roman';">– Tomcat</span><span style="font-family:'宋体';">原生库</span></strong> </p><p>Tomcat<span style="font-family:'宋体';">的原生库基于</span><span style="font-family:Calibri;">Apache</span><span style="font-family:'宋体';">可移植运行时（</span><span style="font-family:Calibri;">Apache Portable Runtime</span><span style="font-family:'宋体';">简称</span><span style="font-family:Calibri;">APR</span><span style="font-family:'宋体';">），给程序员提供了超强的扩展性和性能，在产品运作中帮助融合原生的服务器技术以展现最佳的性能。想知道安装说明的朋友请参考</span><a href="http://www.techbrainwave.com/?p=1017" target="_blank" rel="noopener"><u><span style="color:rgb(0,0,255);">Tomcat Native Library – (APR) Installation</span></u></a><span style="font-family:'宋体';">。</span> </p><p><strong><span style="font-family:'宋体';">第</span>7<span style="font-family:'宋体';">步 </span><span style="font-family:'Times New Roman';">– </span><span style="font-family:'宋体';">其他选项</span></strong> </p><p><span style="font-family:'宋体';">这些选项是：</span> </p><p>· <span style="font-family:'宋体';">开启浏览器的缓存，这样读取存放在</span>webapps<span style="font-family:'宋体';">文件夹里的静态内容会更快，大大推动整体性能。</span></p><p>· <span style="font-family:'宋体';">每当开机时，</span>Tomcat<span style="font-family:'宋体';">服务器应当自动地重启。</span> </p><p>· <span style="font-family:'宋体';">一般情况下</span>HTTPS<span style="font-family:'宋体';">请求会比</span><span style="font-family:Calibri;">HTTP</span><span style="font-family:'宋体';">请求慢。如果你想要更好的安全性，即使慢一点我们还是要选择</span><span style="font-family:Calibri;">HTTPS</span><span style="font-family:'宋体';">。</span>  </p><h2><strong>tomcat<span style="font-family:'宋体';">内存优化</span></strong></h2><p>linux<span style="font-family:'宋体';">修改</span><span style="font-family:Calibri;">TOMCAT_HOME/bin/catalina.sh</span><span style="font-family:'宋体';">，在前面加入</span></p><p>JAVA_OPTS=<span style="color:rgb(128,0,0);">"-XX:PermSize=64M -XX:MaxPermSize=128m -Xms512m -Xmx1024m -Duser.timezone=Asia/Shanghai"</span></p><p>windows<span style="font-family:'宋体';">修改</span><span style="font-family:Calibri;">TOMCAT_HOME/bin/catalina.bat</span><span style="font-family:'宋体';">，在前面加入</span></p><p>set JAVA_OPTS=-XX:PermSize=64M -XX:MaxPermSize=128m -Xms512m -Xmx1024m</p><p><span style="font-family:'宋体';">最大堆内存是</span>1024m<span style="font-family:'宋体';">，对于现在的硬件还是偏低，实施时，还是按照机器具体硬件配置优化。</span></p><p> </p><h2><strong>tomcat <span style="font-family:'宋体';">线程优化</span></strong></h2><p><span style="color:rgb(0,0,255);">&lt;</span><span style="color:rgb(128,0,0);">Connector </span><span style="color:rgb(255,0,0);">port</span><span style="color:rgb(0,0,255);">="80"</span><span style="color:rgb(255,0,0);"> protocol</span><span style="color:rgb(0,0,255);">="HTTP/1.1"</span><span style="color:rgb(255,0,0);"> maxThreads</span><span style="color:rgb(0,0,255);">="600"</span><span style="color:rgb(255,0,0);"> minSpareThreads</span><span style="color:rgb(0,0,255);">="100"</span><span style="color:rgb(255,0,0);"> maxSpareThreads</span><span style="color:rgb(0,0,255);">="500"</span><span style="color:rgb(255,0,0);"> acceptCount</span><span style="color:rgb(0,0,255);">="700"</span></p><p><span style="color:rgb(255,0,0);">connectionTimeout</span><span style="color:rgb(0,0,255);">="20000"</span><span style="color:rgb(255,0,0);"> redirectPort</span><span style="color:rgb(0,0,255);">="8443"</span> <span style="color:rgb(0,0,255);">/&gt;</span></p><p>maxThreads="600"       ///<span style="font-family:'宋体';">最大线程数</span><br />minSpareThreads="100"///<span style="font-family:'宋体';">初始化时创建的线程数</span><br />maxSpareThreads="500"///<span style="font-family:'宋体';">一旦创建的线程超过这个值，</span><span style="font-family:Calibri;">Tomcat</span><span style="font-family:'宋体';">就会关闭不再需要的</span><span style="font-family:Calibri;">socket</span><span style="font-family:'宋体';">线程。</span><br />acceptCount="700"//<span style="font-family:'宋体';">指定当所有可以使用的处理请求的线程数都被使用时，可以放到处理队列中的请求数，超过这个数的请求将不予处理</span></p><p> </p><p><span style="font-family:'宋体';">这里是</span>http connector<span style="font-family:'宋体';">的优化，如果使用</span><span style="font-family:Calibri;">apache</span><span style="font-family:'宋体';">和</span><span style="font-family:Calibri;">tomcat</span><span style="font-family:'宋体';">做集群的负载均衡，并且使用</span><span style="font-family:Calibri;">ajp</span><span style="font-family:'宋体';">协议做</span><span style="font-family:Calibri;">apache</span><span style="font-family:'宋体';">和</span><span style="font-family:Calibri;">tomcat</span><span style="font-family:'宋体';">的协议转发，那么还需要优化</span><span style="font-family:Calibri;">ajp connector</span><span style="font-family:'宋体';">。</span></p><p><span style="color:rgb(0,0,255);">&lt;</span><span style="color:rgb(128,0,0);">Connector </span><span style="color:rgb(255,0,0);">port</span><span style="color:rgb(0,0,255);">="8009"</span><span style="color:rgb(255,0,0);"> protocol</span><span style="color:rgb(0,0,255);">="AJP/1.3"</span><span style="color:rgb(255,0,0);"> maxThreads</span><span style="color:rgb(0,0,255);">="600"</span><span style="color:rgb(255,0,0);"> minSpareThreads</span><span style="color:rgb(0,0,255);">="100"</span><span style="color:rgb(255,0,0);"> maxSpareThreads</span><span style="color:rgb(0,0,255);">="500"</span><span style="color:rgb(255,0,0);"> acceptCount</span><span style="color:rgb(0,0,255);">="700"</span></p><p><span style="color:rgb(255,0,0);">connectionTimeout</span><span style="color:rgb(0,0,255);">="20000"</span><span style="color:rgb(255,0,0);"> redirectPort</span><span style="color:rgb(0,0,255);">="8443"</span> <span style="color:rgb(0,0,255);">/&gt;</span></p><p> </p><p><span style="font-family:'宋体';">由于</span>tomcat<span style="font-family:'宋体';">有多个</span><span style="font-family:Calibri;">connector</span><span style="font-family:'宋体';">，所以</span><span style="font-family:Calibri;">tomcat</span><span style="font-family:'宋体';">线程的配置，又支持多个</span><span style="font-family:Calibri;">connector</span><span style="font-family:'宋体';">共享一个线程池。</span></p><p><span style="font-family:'宋体';">首先。打开</span>/conf/server.xml<span style="font-family:'宋体';">，增加</span></p><p><span style="color:rgb(0,0,255);">&lt;</span><span style="color:rgb(128,0,0);">Executor </span><span style="color:rgb(255,0,0);">name</span><span style="color:rgb(0,0,255);">="tomcatThreadPool"</span><span style="color:rgb(255,0,0);"> namePrefix</span><span style="color:rgb(0,0,255);">="catalina-exec-" </span><span style="color:rgb(255,0,0);">maxThreads</span><span style="color:rgb(0,0,255);">="500"</span><span style="color:rgb(255,0,0);"> minSpareThreads</span><span style="color:rgb(0,0,255);">="20"</span><span style="color:rgb(255,0,0);"> maxIdleTime</span><span style="color:rgb(0,0,255);">="60000"</span> <span style="color:rgb(0,0,255);">/&gt;</span></p><p><span style="font-family:'宋体';">最大线程</span>500<span style="font-family:'宋体';">（一般服务器足以），最小空闲线程数</span><span style="font-family:Calibri;">20</span><span style="font-family:'宋体';">，线程最大空闲时间</span><span style="font-family:Calibri;">60</span><span style="font-family:'宋体';">秒。</span></p><p> </p><p><span style="font-family:'宋体';">然后，修改</span>&lt;Connector ...&gt;<span style="font-family:'宋体';">节点，增加</span><span style="font-family:Calibri;">executor</span><span style="font-family:'宋体';">属性，</span><span style="font-family:Calibri;">executor</span><span style="font-family:'宋体';">设置为线程池的名字：</span></p><p><span style="color:rgb(0,0,255);">&lt;</span><span style="color:rgb(128,0,0);">Connector </span><span style="color:rgb(255,0,0);">executor</span><span style="color:rgb(0,0,255);">="tomcatThreadPool"</span><span style="color:rgb(255,0,0);"> port</span><span style="color:rgb(0,0,255);">="80"</span><span style="color:rgb(255,0,0);"> protocol</span><span style="color:rgb(0,0,255);">="HTTP/1.1"</span><span style="color:rgb(255,0,0);">  connectionTimeout</span><span style="color:rgb(0,0,255);">="60000"</span><span style="color:rgb(255,0,0);"> keepAliveTimeout</span><span style="color:rgb(0,0,255);">="15000"</span><span style="color:rgb(255,0,0);"> maxKeepAliveRequests</span><span style="color:rgb(0,0,255);">="1"</span><span style="color:rgb(255,0,0);">  redirectPort</span><span style="color:rgb(0,0,255);">="443"</span> <span style="color:rgb(0,0,255);">/&gt;</span></p><p><span style="font-family:'宋体';">可以多个</span>connector<span style="font-family:'宋体';">公用</span><span style="font-family:Calibri;">1</span><span style="font-family:'宋体';">个线程池，所以</span><span style="font-family:Calibri;">ajp connector</span><span style="font-family:'宋体';">也同样可以设置使用</span><span style="font-family:Calibri;">tomcatThreadPool</span><span style="font-family:'宋体';">线程池。</span></p><p> </p></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ragty</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gitee.com/huoji555/blog/2018/02/16/Tomcat%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E6%95%B4%E7%90%86/">https://gitee.com/huoji555/blog/2018/02/16/Tomcat%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E6%95%B4%E7%90%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gitee.com/huoji555/blog">Ragty の Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/blog/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BC%98%E5%8C%96-tomcat%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">服务器优化 tomcat性能优化 服务器性能优化</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/blog/2018/03/07/Hibernate%E4%B8%AD%E6%8A%A5%E9%94%99%EF%BC%9AServiceRegistryBuilder%20cannot%20be%20resolved%20to%20a%20type/"><i class="fa fa-chevron-left">  </i><span>Hibernate中报错：ServiceRegistryBuilder cannot be resolved to a type</span></a></div><div class="next-post pull-right"><a href="/blog/2017/12/22/%E5%9B%BE%E7%89%87%E4%BD%8D%E6%95%B0(bites)%E7%9A%84%E5%8C%BA%E5%88%AB/"><span>图片位数(bites)的区别</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'',
  appKey:'',
  placeholder:'ヾﾉ≧∀≦)o来啊，快活啊!',
  avatar:'',
  guest_info:guest_info,
  pageSize:'10',
  lang: ''
})</script></div></div><footer class="footer-bg" style="background-image: url(https://blog-1251750343.cos.ap-beijing.myqcloud.com/blog/blog-bg.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2020 By Ragty</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text"><a href="http://beian.miit.gov.cn " target="_blank" rel="noopener" charset="utf-8"> ICP备案号:京ICP备<13502>号 </a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/blog/js/utils.js?version=1.7.0"></script><script src="/blog/js/fancybox.js?version=1.7.0"></script><script src="/blog/js/sidebar.js?version=1.7.0"></script><script src="/blog/js/copy.js?version=1.7.0"></script><script src="/blog/js/fireworks.js?version=1.7.0"></script><script src="/blog/js/transition.js?version=1.7.0"></script><script src="/blog/js/scroll.js?version=1.7.0"></script><script src="/blog/js/head.js?version=1.7.0"></script><script src="/blog/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>