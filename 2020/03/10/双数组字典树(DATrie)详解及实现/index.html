<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="双数组字典树(DATrie)详解及实现"><meta name="keywords" content="数据结构,词典分词,DATrie"><meta name="author" content="Ragty"><meta name="copyright" content="Ragty"><title>双数组字典树(DATrie)详解及实现 | Ragty の Blog</title><link rel="shortcut icon" href="/blog/melody-favicon.ico"><link rel="stylesheet" href="/blog/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-背景"><span class="toc-text">1.背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-算法及公式解析"><span class="toc-text">2.算法及公式解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-状态冲突及解决方案-划重点"><span class="toc-text">3.状态冲突及解决方案(划重点)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-叶子节点的构造与处理"><span class="toc-text">4.叶子节点的构造与处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-双字典树结构"><span class="toc-text">5.双字典树结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-双字典树的构建"><span class="toc-text">6.双字典树的构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-双数组字典树的插入"><span class="toc-text">7.双数组字典树的插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-双数组字典树的查询"><span class="toc-text">8.双数组字典树的查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-双数组字典树测试"><span class="toc-text">9.双数组字典树测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-测试结果"><span class="toc-text">10.测试结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-总结"><span class="toc-text">11.总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-完整代码-可直接运行"><span class="toc-text">12.完整代码(可直接运行)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#参考文献"><span class="toc-text">参考文献</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/blog/img/avatar.jpg"></div><div class="author-info__name text-center">Ragty</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/huoji555" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/blog/archives"><span class="pull-left">文章</span><span class="pull-right">65</span></a><a class="author-info-articles__tags article-meta" href="/blog/tags"><span class="pull-left">标签</span><span class="pull-right">111</span></a><a class="author-info-articles__categories article-meta" href="/blog/categories"><span class="pull-left">分类</span><span class="pull-right">18</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接-Links</div><a class="author-info-links__name text-center" href="https://blog.csdn.net/huoji555" target="_blank" rel="noopener">MY-CSDN</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/blog/img/top_img.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/blog/">Ragty の Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/blog">Home</a><a class="site-page" href="/blog/archives">Archives</a><a class="site-page" href="/blog/categories">Categories</a><a class="site-page" href="/blog/tags">Tags</a><a class="site-page" href="/blog/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">双数组字典树(DATrie)详解及实现</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-10</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/blog/categories/NLP/">NLP</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.9k</span><span class="post-meta__separator">|</span><span>阅读时长: 17 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><a id="more"></a>

<h3 id="1-背景"><a href="#1-背景" class="headerlink" title="1.背景"></a>1.背景</h3><p><code>Trie树</code>本质是一个确定的有限状态自动机(DFA)，核心思想是空间换时间，利用字符串的公共前缀来降低查询时间的开销以达到提高效率的目的。<strong>但由于<code>Trie树</code>的稀疏现象严重，空间利用率较低</strong>为了让<code>Trie树</code>实现占用较少的空间，同时还要保证查询的效率，最后提出了用2个线性数组来进行<code>Trie树</code>的表示，即<code>双数组Trie(Double Array Trie)</code>.</p>
<br>

<h3 id="2-算法及公式解析"><a href="#2-算法及公式解析" class="headerlink" title="2.算法及公式解析"></a><strong>2.算法及公式解析</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base[s] + c = t</span><br><span class="line">check[t] =  s</span><br></pre></td></tr></table></figure>

<p>往往读到这里，大家都是一头雾水，不知所云，我们首先了解下<code>base</code>和<code>check</code>代表的意义及作用</p>
<blockquote>
<p>base数组的每个元素表示一个<code>Trie节点</code>，即一个状态(分为空闲状态和占用状态)<br>check数组的每个元素表示某个状态的前驱状态</p>
</blockquote>
<p>现在我们分析一下以上出现的公式</p>
<blockquote>
<p>base树组中的<code>s</code>代表当前状态的下标，<code>t</code>代表转移状态的下标，<code>c</code>代表输入字符的数值</p>
<p>base[s] + c =  t   //表示一次状态转移</p>
<p>由于转移后状态下标为<code>t</code>,且父子关系是唯一的，所以可通过检验当前元素的前驱状态确定转移是否成功</p>
<p>check[t] =  s    //检验状态转移是否成功</p>
</blockquote>
<p>那么这种算法相对于传统的<code>Trie树</code>的<strong>优点</strong>是，<strong>只需要一个加法一次比较即可完成一次状态转移，只花费了常数时间</strong>，下面给出了<code>双数组Trie树</code>的原理图（注意观察状态转移的过程）<br><img src="https://img-blog.csdnimg.cn/20200310233002360.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1b2ppNTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<br>

<h3 id="3-状态冲突及解决方案-划重点"><a href="#3-状态冲突及解决方案-划重点" class="headerlink" title="3.状态冲突及解决方案(划重点)"></a><strong>3.状态冲突及解决方案(划重点)</strong></h3><blockquote>
<p>说的简单一点，状态冲突的意思就是，进行状态转移时，发现转换的位置base[t]已经被人占了(<strong>状态冲突</strong>)，那你怎么办呢，重新改变c值(<strong>改变父节点的转移基数</strong>)，让它放在base数组中未被占用的位置</p>
<p>解决方案，用while函数由发生冲突的位置向前遍历，一旦发现有空位置便占用并更新转移基数(<strong>也就是c值</strong>)，可以把这个过程看作为公交车上从后往前占座的过程</p>
<p>构造字典时，如果有新词加入，若新词的首字未出现，写入时有冲突的情况下，导致根节点的转移基数改变，会导致重构整个树的情况(否则不能进行正确的状态转移)，所以<strong>构建树时建议先构建每个词的首字，再构建各个词的子节点</strong>，这样产生冲突的情况下，可以将冲突局限在单个父节点和子节点之间，不至于大范围的节点重构</p>
</blockquote>
<br>

<h3 id="4-叶子节点的构造与处理"><a href="#4-叶子节点的构造与处理" class="headerlink" title="4.叶子节点的构造与处理"></a><strong>4.叶子节点的构造与处理</strong></h3><p>下面介绍几种处理叶子节点的处理方案：</p>
<ul>
<li><strong>将每个词的词尾设置为特殊字符(/0)</strong>，因为最后一个字已经不需要状态转移，所以可以这样构造，但是增加了节点的数量，构建字典时会造成消耗</li>
<li><strong>将每个词的词尾设置为转移基数的负数(只有词尾为负值)</strong>，这样能够节省构建时间，不过进行转移时要将状态转移函数改为<code>|base[s]|+code(字符)</code></li>
</ul>
<p>我们的实现中采用后一种构建方案</p>
<br>

<h3 id="5-双字典树结构"><a href="#5-双字典树结构" class="headerlink" title="5.双字典树结构"></a><strong>5.双字典树结构</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> ARRAY_SIZE = <span class="number">655350</span>;  <span class="comment">//数组大小</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> BASE_ROOT = <span class="number">1</span>;        <span class="comment">//base根节点状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> BASE_NULL = <span class="number">0</span>;        <span class="comment">//base空闲状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> CHECK_ROOT = -<span class="number">1</span>;      <span class="comment">//check根节点状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> CHECK_NULL = -<span class="number">2</span>;      <span class="comment">//check空闲状态</span></span><br><span class="line"><span class="keyword">private</span> TrieNode base[];</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> check[];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/3/5 16:05</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: DATrie节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> transferRatio; <span class="comment">//转移基数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isLeaf = <span class="keyword">false</span>; <span class="comment">//是否为叶子节点</span></span><br><span class="line">    <span class="keyword">private</span> Character label = <span class="keyword">null</span>; <span class="comment">//节点标识即插入的字符本身</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value = -<span class="number">1</span>; <span class="comment">//当该节点为叶子节点时关联的字典表中对应词条的索引号</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTransferRatio</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> transferRatio;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransferRatio</span><span class="params">(<span class="keyword">int</span> transferRatio)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transferRatio = transferRatio;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLeaf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isLeaf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeaf</span><span class="params">(<span class="keyword">boolean</span> leaf)</span> </span>&#123;</span><br><span class="line">        isLeaf = leaf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Character <span class="title">getLabel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> label;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLabel</span><span class="params">(Character label)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.label = label;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="6-双字典树的构建"><a href="#6-双字典树的构建" class="headerlink" title="6.双字典树的构建"></a><strong>6.双字典树的构建</strong></h3><blockquote>
<p>这里说一句，构建的准则是，<strong>先构建每个词的首字，后构建每个词的剩余节点</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/3/10 19:37</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 构造DATrie</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(List&lt;String&gt; words)</span> </span>&#123;</span><br><span class="line">    init();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> shut = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> idx = <span class="number">0</span>; idx &lt; words.size(); idx++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> startState = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span> chars[] = words.get(idx).toCharArray();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (shut == <span class="keyword">false</span>) &#123;</span><br><span class="line">            TrieNode node = insert(startState, getCode(chars[<span class="number">0</span>]), (chars.length == <span class="number">1</span>), idx);</span><br><span class="line">            node.setLabel(chars[<span class="number">0</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;chars.length; j++) &#123;</span><br><span class="line">                startState = transfer(startState, getCode(chars[j-<span class="number">1</span>]));</span><br><span class="line">                TrieNode node = insert(startState, getCode(chars[j]), (chars.length == j+<span class="number">1</span>), idx);</span><br><span class="line">                node.setLabel(chars[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (idx == words.size()-<span class="number">1</span> &amp;&amp; shut == <span class="keyword">false</span>) &#123;</span><br><span class="line">            idx = -<span class="number">1</span>;   <span class="comment">//因为开始的时候还有一个加的过程</span></span><br><span class="line">            shut = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/3/5 16:06</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 初始化DATrie（base，check数组全部初始化）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    base = <span class="keyword">new</span> TrieNode[ARRAY_SIZE];</span><br><span class="line">    check = <span class="keyword">new</span> <span class="keyword">int</span>[ARRAY_SIZE];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">        TrieNode node = <span class="keyword">new</span> TrieNode();</span><br><span class="line">        node.setTransferRatio(BASE_NULL);</span><br><span class="line">        base[i] = node;</span><br><span class="line">        check[i] = CHECK_NULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TrieNode root = <span class="keyword">new</span> TrieNode();</span><br><span class="line">    root.setTransferRatio(BASE_ROOT);</span><br><span class="line">    base[<span class="number">0</span>] = root;</span><br><span class="line">    check[<span class="number">0</span>] = CHECK_ROOT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="7-双数组字典树的插入"><a href="#7-双数组字典树的插入" class="headerlink" title="7.双数组字典树的插入"></a>7.双数组字典树的插入</h3><blockquote>
<p>插入时，有冲突需要解决冲突，无冲突再检查是否为叶子节点，最后进行状态转移</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/3/5 18:49</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 根据起始状态和转移技术插入新节点并返回插入的节点</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> startState 起始状态</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> offset  状态偏移量</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> isLeaf  是否为叶子节点</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> idx 当前节点在词典中的索引号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> TrieNode <span class="title">insert</span><span class="params">(<span class="keyword">int</span> startState, <span class="keyword">int</span> offset, <span class="keyword">boolean</span> isLeaf, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> endState = transfer(startState, offset); <span class="comment">//状态转移</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (base[endState].getTransferRatio() != BASE_NULL &amp;&amp; check[endState] != startState) &#123; <span class="comment">//已被占用</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            endState += <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (base[endState].getTransferRatio() != BASE_NULL);</span><br><span class="line"></span><br><span class="line">        base[startState].setTransferRatio(endState - offset); <span class="comment">//改变父节点转移基数</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isLeaf) &#123;</span><br><span class="line">        base[endState].setTransferRatio(Math.abs(base[startState].getTransferRatio())*-<span class="number">1</span>); <span class="comment">//叶子节点转移基数标识为父节点转移基数的相反数</span></span><br><span class="line">        base[endState].setLeaf(<span class="keyword">true</span>);</span><br><span class="line">        base[endState].setValue(idx); <span class="comment">//为叶子节点时需要记录下该词在字典中的索引号</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (base[endState].getTransferRatio() == BASE_NULL) &#123; <span class="comment">//未有节点经过</span></span><br><span class="line">            base[endState].setTransferRatio(Math.abs(base[startState].getTransferRatio())); <span class="comment">//非叶子节点的转移基数一定为正</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    check[endState] = startState;<span class="comment">//check中记录当前状态的父状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> base[endState];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="8-双数组字典树的查询"><a href="#8-双数组字典树的查询" class="headerlink" title="8.双数组字典树的查询"></a><strong>8.双数组字典树的查询</strong></h3><p>这里我写的比较简单，用<strong>正向匹配</strong>做的，这里比较关键的一句是这个</p>
<blockquote>
<p><code>base[endState].getTransferRatio() != BASE_NULL &amp;&amp; check[endState] == startState</code></p>
</blockquote>
<p>可以检测出节点是否在树上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Date</span>: 2020/3/5 18:54</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>: 查询匹配项(正向匹配)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">match</span><span class="params">(String keyWord)</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; result = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">int</span> startState, endState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> chars[] = keyWord.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; chars.length; i++) &#123;</span><br><span class="line">        startState = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; chars.length; j++) &#123;</span><br><span class="line">            endState = transfer(startState, getCode(chars[j]));</span><br><span class="line">            <span class="keyword">if</span> (base[endState].getTransferRatio() != BASE_NULL &amp;&amp; check[endState] == startState) &#123; <span class="comment">//节点存在于 Trie 树上</span></span><br><span class="line">                <span class="keyword">if</span> (base[endState].isLeaf()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!result.contains(base[endState].getValue())) &#123;</span><br><span class="line">                        result.add(base[endState].getValue());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                startState = endState;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="9-双数组字典树测试"><a href="#9-双数组字典树测试" class="headerlink" title="9.双数组字典树测试"></a>9.<strong>双数组字典树测试</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; words = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    words.add(<span class="string">"清华"</span>);</span><br><span class="line">    words.add(<span class="string">"清华大学"</span>);</span><br><span class="line">    words.add(<span class="string">"清新"</span>);</span><br><span class="line">    words.add(<span class="string">"中华"</span>);</span><br><span class="line">    words.add(<span class="string">"中华人民"</span>);</span><br><span class="line">    words.add(<span class="string">"华人"</span>);</span><br><span class="line">    words.add(<span class="string">"学生"</span>);</span><br><span class="line">    words.add(<span class="string">"大学生"</span>);</span><br><span class="line">    words.add(<span class="string">"wo"</span>);</span><br><span class="line">    words.add(<span class="string">"shi"</span>);</span><br><span class="line">    words.add(<span class="string">"human"</span>);</span><br><span class="line">    words.add(<span class="string">"this"</span>);</span><br><span class="line">    words.add(<span class="string">"is"</span>);</span><br><span class="line">    words.add(<span class="string">"ragty"</span>);</span><br><span class="line">    words.add(<span class="string">"pump"</span>);</span><br><span class="line">    words.add(<span class="string">"it"</span>);</span><br><span class="line">    words.add(<span class="string">"up"</span>);</span><br><span class="line">    words.add(<span class="string">"中国"</span>);</span><br><span class="line">    words.add(<span class="string">"人名"</span>);</span><br><span class="line">    words.add(<span class="string">"中国人民"</span>);</span><br><span class="line">    words.add(<span class="string">"人民"</span>);</span><br><span class="line">    words.add(<span class="string">"java"</span>);</span><br><span class="line">    words.add(<span class="string">"java学习"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构建 Trie 树</span></span><br><span class="line">    DATrie daTrie = <span class="keyword">new</span> DATrie();</span><br><span class="line">    daTrie.build(words);</span><br><span class="line">    daTrie.printTrie();</span><br><span class="line"></span><br><span class="line">    String keyWord = <span class="string">"清华大学生都是华人"</span>;</span><br><span class="line">    List&lt;Integer&gt; result = daTrie.match(keyWord);</span><br><span class="line">    System.out.println();</span><br><span class="line">    System.out.println(<span class="string">"输入语句为："</span>+keyWord);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打印匹配结果</span></span><br><span class="line">    System.out.println();</span><br><span class="line">    System.out.printf(<span class="string">"Match: &#123;"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.size(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.printf(<span class="string">"%s"</span>, words.get(result.get(i)));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.printf(<span class="string">", %s"</span>, words.get(result.get(i)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.printf(<span class="string">"&#125;"</span>);</span><br><span class="line">    System.out.println();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="10-测试结果"><a href="#10-测试结果" class="headerlink" title="10.测试结果"></a><strong>10.测试结果</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  idx      <span class="number">0</span>	     <span class="number">98</span>	     <span class="number">99</span>	    <span class="number">100</span>	    <span class="number">104</span>	    <span class="number">105</span>	    <span class="number">106</span>	    <span class="number">107</span>	    <span class="number">108</span>	    <span class="number">109</span>	    <span class="number">110</span>	    <span class="number">111</span>	    <span class="number">112</span>	    <span class="number">113</span>	    <span class="number">114</span>	    <span class="number">115</span>	    <span class="number">116</span>	    <span class="number">117</span>	    <span class="number">118</span>	    <span class="number">119</span>	    <span class="number">120</span>	    <span class="number">121</span>	    <span class="number">122</span>	    <span class="number">123</span>	    <span class="number">124</span>	    <span class="number">125</span>	    <span class="number">126</span>	    <span class="number">127</span>	    <span class="number">128</span>	    <span class="number">129</span>	    <span class="number">130</span>	    <span class="number">131</span>	    <span class="number">132</span>	  <span class="number">20014</span>	  <span class="number">20099</span>	  <span class="number">20155</span>	  <span class="number">20156</span>	  <span class="number">20157</span>	  <span class="number">20158</span>	  <span class="number">21327</span>	  <span class="number">21328</span>	  <span class="number">21329</span>	  <span class="number">21518</span>	  <span class="number">22272</span>	  <span class="number">22824</span>	  <span class="number">22825</span>	  <span class="number">23399</span>	  <span class="number">23400</span>	  <span class="number">23401</span>	  <span class="number">23433</span>	  <span class="number">26034</span>	  <span class="number">27666</span>	  <span class="number">27668</span>	  <span class="number">27669</span>	  <span class="number">28166</span>	  <span class="number">29984</span>	  <span class="number">29986</span>	</span><br><span class="line"> <span class="keyword">char</span>   <span class="keyword">null</span>	      a	      a	      a	      g	      h	      i	      j	      h	      i	      h	      m	      o	      p	      n	      r	      s	      t	      u	      u	      w	      i	      s	      t	      u	      m	      t	      p	      y	      p	      v	      s	      a	      中	      习	      人	      人	      人	      人	      华	      华	      华	      名	      国	      大	      大	      学	      学	      学	      学	      新	      民	      民	      民	      清	      生	      生	</span><br><span class="line"> base      <span class="number">1</span>	      <span class="number">1</span>	      <span class="number">4</span>	     <span class="number">12</span>	      <span class="number">7</span>	      <span class="number">2</span>	     <span class="number">10</span>	      <span class="number">3</span>	      <span class="number">4</span>	     -<span class="number">4</span>	     <span class="number">16</span>	      <span class="number">2</span>	     -<span class="number">1</span>	      <span class="number">7</span>	     -<span class="number">4</span>	      <span class="number">1</span>	      <span class="number">4</span>	      <span class="number">6</span>	     <span class="number">15</span>	      <span class="number">2</span>	      <span class="number">1</span>	     <span class="number">16</span>	     -<span class="number">7</span>	      <span class="number">7</span>	     <span class="number">16</span>	     <span class="number">17</span>	    -<span class="number">10</span>	    -<span class="number">15</span>	     -<span class="number">7</span>	    -<span class="number">17</span>	     <span class="number">35</span>	    -<span class="number">16</span>	    -<span class="number">35</span>	      <span class="number">3</span>	    -<span class="number">35</span>	      <span class="number">1</span>	     -<span class="number">2</span>	      <span class="number">3</span>	      <span class="number">4</span>	      <span class="number">2</span>	     -<span class="number">2</span>	     -<span class="number">3</span>	     -<span class="number">1</span>	      <span class="number">4</span>	      <span class="number">3</span>	      <span class="number">2</span>	      <span class="number">1</span>	     -<span class="number">2</span>	      <span class="number">3</span>	     <span class="number">35</span>	     -<span class="number">2</span>	     -<span class="number">1</span>	     -<span class="number">3</span>	     -<span class="number">4</span>	      <span class="number">2</span>	     -<span class="number">1</span>	     -<span class="number">3</span>	</span><br><span class="line">check     -<span class="number">1</span>	    <span class="number">115</span>	    <span class="number">111</span>	    <span class="number">107</span>	     <span class="number">98</span>	      <span class="number">0</span>	      <span class="number">0</span>	      <span class="number">0</span>	    <span class="number">116</span>	    <span class="number">108</span>	    <span class="number">117</span>	    <span class="number">119</span>	    <span class="number">120</span>	      <span class="number">0</span>	     <span class="number">99</span>	      <span class="number">0</span>	      <span class="number">0</span>	      <span class="number">0</span>	      <span class="number">0</span>	    <span class="number">105</span>	      <span class="number">0</span>	    <span class="number">110</span>	    <span class="number">106</span>	    <span class="number">104</span>	    <span class="number">113</span>	    <span class="number">124</span>	    <span class="number">106</span>	    <span class="number">118</span>	    <span class="number">123</span>	    <span class="number">125</span>	    <span class="number">100</span>	    <span class="number">121</span>	    <span class="number">130</span>	      <span class="number">0</span>	  <span class="number">23433</span>	      <span class="number">0</span>	  <span class="number">21327</span>	  <span class="number">21329</span>	  <span class="number">22272</span>	      <span class="number">0</span>	  <span class="number">28166</span>	  <span class="number">20014</span>	  <span class="number">20155</span>	  <span class="number">20014</span>	      <span class="number">0</span>	  <span class="number">21328</span>	      <span class="number">0</span>	  <span class="number">22825</span>	  <span class="number">22824</span>	    <span class="number">132</span>	  <span class="number">28166</span>	  <span class="number">20155</span>	  <span class="number">20157</span>	  <span class="number">20158</span>	      <span class="number">0</span>	  <span class="number">23399</span>	  <span class="number">23401</span>	</span><br><span class="line"> leaf      否	      否	      否	      否	      否	      否	      否	      否	      否	      是	      否	      否	      是	      否	      是	      否	      否	      否	      否	      否	      否	      否	      是	      否	      否	      否	      是	      是	      是	      是	      否	      是	      是	      否	      是	      否	      是	      否	      否	      否	      是	      是	      是	      是	      否	      否	      否	      是	      否	      否	      是	      是	      是	      是	      否	      是	      是	</span><br><span class="line">  idx     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	      <span class="number">9</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	      <span class="number">8</span>	     -<span class="number">1</span>	     <span class="number">10</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     <span class="number">12</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     <span class="number">15</span>	     <span class="number">16</span>	     <span class="number">13</span>	     <span class="number">14</span>	     -<span class="number">1</span>	     <span class="number">11</span>	     <span class="number">21</span>	     -<span class="number">1</span>	     <span class="number">22</span>	     -<span class="number">1</span>	      <span class="number">5</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	      <span class="number">0</span>	      <span class="number">3</span>	     <span class="number">18</span>	     <span class="number">17</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	      <span class="number">1</span>	     -<span class="number">1</span>	     -<span class="number">1</span>	      <span class="number">2</span>	     <span class="number">20</span>	      <span class="number">4</span>	     <span class="number">19</span>	     -<span class="number">1</span>	      <span class="number">6</span>	      <span class="number">7</span>	</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">输入语句为：清华大学生都是华人</span><br><span class="line"></span><br><span class="line">Match: &#123;清华, 清华大学, 大学生, 学生, 华人&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="11-总结"><a href="#11-总结" class="headerlink" title="11.总结"></a><strong>11.总结</strong></h3><blockquote>
<p>我刚开始写的时候没有任何头绪，看到那两个公式一头雾水，查了很多博客也写得一知半解，而且没有公式解析和实现代码。经过查阅文献以及自己的思考，有了这篇文章，希望能帮到更多想了解<code>DATrie</code>的人。</p>
<p>任何事情你清楚他要解决的问题和实现原理后，会发现它很简单。就像<code>DATrie</code>，它的难点在于核心公式的理解以及对于冲突的解决方案。只要理解了这个，实现是很简单的一件事。</p>
</blockquote>
<br>

<h3 id="12-完整代码-可直接运行"><a href="#12-完整代码-可直接运行" class="headerlink" title="12.完整代码(可直接运行)"></a><strong>12.完整代码(可直接运行)</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dictionary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DATrie</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> ARRAY_SIZE = <span class="number">655350</span>;  <span class="comment">//数组大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> BASE_ROOT = <span class="number">1</span>;        <span class="comment">//base根节点状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> BASE_NULL = <span class="number">0</span>;        <span class="comment">//base空闲状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> CHECK_ROOT = -<span class="number">1</span>;      <span class="comment">//check根节点状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> CHECK_NULL = -<span class="number">2</span>;      <span class="comment">//check空闲状态</span></span><br><span class="line">    <span class="keyword">private</span> TrieNode base[];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> check[];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 16:05</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: DATrie节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> transferRatio; <span class="comment">//转移基数</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isLeaf = <span class="keyword">false</span>; <span class="comment">//是否为叶子节点</span></span><br><span class="line">        <span class="keyword">private</span> Character label = <span class="keyword">null</span>; <span class="comment">//节点标识即插入的字符本身</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> value = -<span class="number">1</span>; <span class="comment">//当该节点为叶子节点时关联的字典表中对应词条的索引号</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTransferRatio</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> transferRatio;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransferRatio</span><span class="params">(<span class="keyword">int</span> transferRatio)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.transferRatio = transferRatio;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLeaf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> isLeaf;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeaf</span><span class="params">(<span class="keyword">boolean</span> leaf)</span> </span>&#123;</span><br><span class="line">            isLeaf = leaf;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Character <span class="title">getLabel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> label;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLabel</span><span class="params">(Character label)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.label = label;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/10 19:37</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 构造DATrie</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(List&lt;String&gt; words)</span> </span>&#123;</span><br><span class="line">        init();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> shut = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> idx = <span class="number">0</span>; idx &lt; words.size(); idx++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> startState = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">char</span> chars[] = words.get(idx).toCharArray();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (shut == <span class="keyword">false</span>) &#123;</span><br><span class="line">                TrieNode node = insert(startState, getCode(chars[<span class="number">0</span>]), (chars.length == <span class="number">1</span>), idx);</span><br><span class="line">                node.setLabel(chars[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;chars.length; j++) &#123;</span><br><span class="line">                    startState = transfer(startState, getCode(chars[j-<span class="number">1</span>]));</span><br><span class="line">                    TrieNode node = insert(startState, getCode(chars[j]), (chars.length == j+<span class="number">1</span>), idx);</span><br><span class="line">                    node.setLabel(chars[j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (idx == words.size()-<span class="number">1</span> &amp;&amp; shut == <span class="keyword">false</span>) &#123;</span><br><span class="line">                idx = -<span class="number">1</span>;   <span class="comment">//因为开始的时候还有一个加的过程</span></span><br><span class="line">                shut = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 18:54</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 查询匹配项(正向匹配)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">match</span><span class="params">(String keyWord)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">int</span> startState, endState;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span> chars[] = keyWord.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; chars.length; i++) &#123;</span><br><span class="line">            startState = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; chars.length; j++) &#123;</span><br><span class="line">                endState = transfer(startState, getCode(chars[j]));</span><br><span class="line">                <span class="keyword">if</span> (base[endState].getTransferRatio() != BASE_NULL &amp;&amp; check[endState] == startState) &#123; <span class="comment">//节点存在于 Trie 树上</span></span><br><span class="line">                    <span class="keyword">if</span> (base[endState].isLeaf()) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!result.contains(base[endState].getValue())) &#123;</span><br><span class="line">                            result.add(base[endState].getValue());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    startState = endState;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 19:00</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 打印DATrie</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printTrie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"idx"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7d\t"</span>, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"char"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7c\t"</span>, base[i].getLabel());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"base"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7d\t"</span>, base[i].getTransferRatio());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"check"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7d\t"</span>, check[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"leaf"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7s\t"</span>, base[i].isLeaf() ? <span class="string">"是"</span> : <span class="string">"否"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"%5s"</span>, <span class="string">"idx"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i].getTransferRatio() != BASE_NULL) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%7d\t"</span>, base[i].getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 18:49</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 根据起始状态和转移技术插入新节点并返回插入的节点</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@param</span> startState 起始状态</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@param</span> offset  状态偏移量</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@param</span> isLeaf  是否为叶子节点</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@param</span> idx 当前节点在词典中的索引号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TrieNode <span class="title">insert</span><span class="params">(<span class="keyword">int</span> startState, <span class="keyword">int</span> offset, <span class="keyword">boolean</span> isLeaf, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> endState = transfer(startState, offset); <span class="comment">//状态转移</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (base[endState].getTransferRatio() != BASE_NULL &amp;&amp; check[endState] != startState) &#123; <span class="comment">//已被占用</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                endState += <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">while</span> (base[endState].getTransferRatio() != BASE_NULL);</span><br><span class="line"></span><br><span class="line">            base[startState].setTransferRatio(endState - offset); <span class="comment">//改变父节点转移基数</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isLeaf) &#123;</span><br><span class="line">            base[endState].setTransferRatio(Math.abs(base[startState].getTransferRatio())*-<span class="number">1</span>); <span class="comment">//叶子节点转移基数标识为父节点转移基数的相反数</span></span><br><span class="line">            base[endState].setLeaf(<span class="keyword">true</span>);</span><br><span class="line">            base[endState].setValue(idx); <span class="comment">//为叶子节点时需要记录下该词在字典中的索引号</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (base[endState].getTransferRatio() == BASE_NULL) &#123; <span class="comment">//未有节点经过</span></span><br><span class="line">                base[endState].setTransferRatio(Math.abs(base[startState].getTransferRatio())); <span class="comment">//非叶子节点的转移基数一定为正</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        check[endState] = startState;<span class="comment">//check中记录当前状态的父状态</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> base[endState];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 18:53</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 根据起始状态和转移基数返回结束状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">transfer</span><span class="params">(<span class="keyword">int</span> startState, <span class="keyword">int</span> offset)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.abs(base[startState].getTransferRatio())+offset; <span class="comment">//状态转移</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 19:13</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 获取base数组的下标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)c;<span class="comment">//这里必须大于0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@author</span>: Ragty</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Date</span>: 2020/3/5 16:06</span></span><br><span class="line"><span class="comment">     *  <span class="doctag">@Description</span>: 初始化DATrie（base，check数组全部初始化）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        base = <span class="keyword">new</span> TrieNode[ARRAY_SIZE];</span><br><span class="line">        check = <span class="keyword">new</span> <span class="keyword">int</span>[ARRAY_SIZE];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; i++) &#123;</span><br><span class="line">            TrieNode node = <span class="keyword">new</span> TrieNode();</span><br><span class="line">            node.setTransferRatio(BASE_NULL);</span><br><span class="line">            base[i] = node;</span><br><span class="line">            check[i] = CHECK_NULL;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TrieNode root = <span class="keyword">new</span> TrieNode();</span><br><span class="line">        root.setTransferRatio(BASE_ROOT);</span><br><span class="line">        base[<span class="number">0</span>] = root;</span><br><span class="line">        check[<span class="number">0</span>] = CHECK_ROOT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; words = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        words.add(<span class="string">"清华"</span>);</span><br><span class="line">        words.add(<span class="string">"清华大学"</span>);</span><br><span class="line">        words.add(<span class="string">"清新"</span>);</span><br><span class="line">        words.add(<span class="string">"中华"</span>);</span><br><span class="line">        words.add(<span class="string">"中华人民"</span>);</span><br><span class="line">        words.add(<span class="string">"华人"</span>);</span><br><span class="line">        words.add(<span class="string">"学生"</span>);</span><br><span class="line">        words.add(<span class="string">"大学生"</span>);</span><br><span class="line">        words.add(<span class="string">"wo"</span>);</span><br><span class="line">        words.add(<span class="string">"shi"</span>);</span><br><span class="line">        words.add(<span class="string">"human"</span>);</span><br><span class="line">        words.add(<span class="string">"this"</span>);</span><br><span class="line">        words.add(<span class="string">"is"</span>);</span><br><span class="line">        words.add(<span class="string">"ragty"</span>);</span><br><span class="line">        words.add(<span class="string">"pump"</span>);</span><br><span class="line">        words.add(<span class="string">"it"</span>);</span><br><span class="line">        words.add(<span class="string">"up"</span>);</span><br><span class="line">        words.add(<span class="string">"中国"</span>);</span><br><span class="line">        words.add(<span class="string">"人名"</span>);</span><br><span class="line">        words.add(<span class="string">"中国人民"</span>);</span><br><span class="line">        words.add(<span class="string">"人民"</span>);</span><br><span class="line">        words.add(<span class="string">"java"</span>);</span><br><span class="line">        words.add(<span class="string">"java学习"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建 Trie 树</span></span><br><span class="line">        DATrie daTrie = <span class="keyword">new</span> DATrie();</span><br><span class="line">        daTrie.build(words);</span><br><span class="line">        daTrie.printTrie();</span><br><span class="line"></span><br><span class="line">        String keyWord = <span class="string">"清华大学生都是华人"</span>;</span><br><span class="line">        List&lt;Integer&gt; result = daTrie.match(keyWord);</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">"输入语句为："</span>+keyWord);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打印匹配结果</span></span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.printf(<span class="string">"Match: &#123;"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%s"</span>, words.get(result.get(i)));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.printf(<span class="string">", %s"</span>, words.get(result.get(i)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">"&#125;"</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h5 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h5><p>1.<a href="https://segmentfault.com/a/1190000008877595" target="_blank" rel="noopener">小白详解Trie树</a><br>2.<a href="http://www.cnki.com.cn/Article/CJFDTotal-RJDK201207007.htm" target="_blank" rel="noopener">《基于双数组Ｔｒｉｅ树算法的字典改进和实现》</a><br>3.<a href="https://www.semanticscholar.org/paper/An-Efficient-Implementation-of-Trie-Structures-Aoe-Morimoto/f2ad2a67218e458a979afafb311d1d7867f3f624" target="_blank" rel="noopener">Theppitak Karoonboonyanan, An Implementation of Double-Array Trie.</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ragty</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gitee.com/huoji555/blog/2020/03/10/%E5%8F%8C%E6%95%B0%E7%BB%84%E5%AD%97%E5%85%B8%E6%A0%91(DATrie)%E8%AF%A6%E8%A7%A3%E5%8F%8A%E5%AE%9E%E7%8E%B0/">https://gitee.com/huoji555/blog/2020/03/10/%E5%8F%8C%E6%95%B0%E7%BB%84%E5%AD%97%E5%85%B8%E6%A0%91(DATrie)%E8%AF%A6%E8%A7%A3%E5%8F%8A%E5%AE%9E%E7%8E%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gitee.com/huoji555/blog">Ragty の Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/blog/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a><a class="post-meta__tags" href="/blog/tags/%E8%AF%8D%E5%85%B8%E5%88%86%E8%AF%8D/">词典分词</a><a class="post-meta__tags" href="/blog/tags/DATrie/">DATrie</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/blog/2020/04/10/AC%E8%87%AA%E5%8A%A8%E6%9C%BA/"><i class="fa fa-chevron-left">  </i><span>AC自动机详解及实现</span></a></div><div class="next-post pull-right"><a href="/blog/2020/02/25/%E5%AD%97%E5%85%B8%E6%A0%91%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%8F%8A%E5%AE%9E%E7%8E%B0(%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87%E6%8F%92%E5%85%A5)/"><span>字典树原理分析及实现(支持中文插入)</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '64bb26cd3e1c8abc30b9',
  clientSecret: '2c12bfa74e197296c7f3fe590350ba444099ef0b',
  repo: 'huoji555.github.io',
  owner: 'huoji555',
  admin: 'huoji555',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(/blog/img/top_img.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2020 By Ragty</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text"><a href="http://beian.miit.gov.cn " target="_blank" rel="noopener" charset="utf-8"> ICP备案号:京ICP备<13502>号 </a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/blog/js/utils.js?version=1.7.0"></script><script src="/blog/js/fancybox.js?version=1.7.0"></script><script src="/blog/js/sidebar.js?version=1.7.0"></script><script src="/blog/js/copy.js?version=1.7.0"></script><script src="/blog/js/fireworks.js?version=1.7.0"></script><script src="/blog/js/transition.js?version=1.7.0"></script><script src="/blog/js/scroll.js?version=1.7.0"></script><script src="/blog/js/head.js?version=1.7.0"></script><script src="/blog/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>